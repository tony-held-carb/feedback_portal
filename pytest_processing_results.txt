============================= test session starts ==============================
platform linux -- Python 3.11.13, pytest-8.4.1, pluggy-1.6.0 -- /home/tonyh/miniconda3/envs/mini_conda_02/bin/python
cachedir: .pytest_cache
rootdir: /home/tonyh/git_repos/feedback_portal
configfile: pytest.ini
plugins: base-url-2.1.0, anyio-4.7.0, playwright-0.7.0, asyncio-1.1.0
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 17 items

tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_processor_initialization PASSED [  5%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_processor_default_config PASSED [ 11%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_basic FAILED [ 17%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_with_schemas FAILED [ 23%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_with_required_tabs FAILED [ 29%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_nonexistent FAILED [ 35%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_strict_mode PASSED [ 41%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_tab_with_schema PASSED [ 47%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_tab_without_schema PASSED [ 52%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_tab_not_found PASSED [ 58%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_processing_statistics FAILED [ 64%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_validation_integration FAILED [ 70%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_error_handling PASSED [ 76%]
tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_workbook_cleanup FAILED [ 82%]
tests/arb/utils/excel/test_processing_layer.py::TestProcessingIntegration::test_processor_with_validators PASSED [ 88%]
tests/arb/utils/excel/test_processing_layer.py::TestProcessingIntegration::test_end_to_end_processing_workflow FAILED [ 94%]
tests/arb/utils/excel/test_processing_layer.py::TestProcessingIntegration::test_configuration_impact FAILED [100%]

=================================== FAILURES ===================================
__________________ TestExcelProcessor.test_process_file_basic __________________
tests/arb/utils/excel/test_processing_layer.py:146: in test_process_file_basic
    assert result.success is True
E   AssertionError: assert False is True
E    +  where False = ExcelParseResult(success=False, metadata={}, schemas={}, tab_contents={}, validation_results=[ValidationResult(field_name='file_path', is_valid=True, message='File path is valid and accessible: /tmp/tmpovik8s1u/test.xlsx', severity='INFO', location='/tmp/tmpovik8s1u/test.xlsx', context={}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 913846)), ValidationResult(field_name='file_format', is_valid=True, message='File format is valid: .xlsx', severity='INFO', location='/tmp/tmpovik8s1u/test.xlsx', context={'file_extension': '.xlsx'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 914486)), ValidationResult(field_name='file_size', is_valid=True, message='File size 0.00MB is within limits', severity='INFO', location='/tmp/tmpovik8s1u/test.xlsx', context={'file_size_mb': 0.0020303726196289062, 'max_size_mb': 10, 'file_size_bytes': 2129}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 914501)), ValidationResult(field_name='workbook_loading', is_valid=False, message='Failed to load workbook for validation: unbound prefix: line 4, column 8', severity='ERROR', location='/tmp/tmpovik8s1u/test.xlsx', context={'exception': 'unbound prefix: line 4, column 8'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 915462))], processing_stats=ProcessingStats(start_time=1755140171.9138265, end_time=1755140171.9160724, rows_processed=0, cells_processed=0, tabs_processed=0, fields_processed=0, validation_errors=1, processing_errors=0, warnings=0, memory_usage_mb=0.0), errors=['Failed to load workbook', 'Failed to load workbook for validation: unbound prefix: line 4, column 8'], warnings=[], file_path=PosixPath('/tmp/tmpovik8s1u/test.xlsx'), processing_time=0.0022459030151367188, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 916078)).success
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: unbound prefix: line 4, column 8
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpovik8s1u/test.xlsx, error: unbound prefix: line 4, column 8
______________ TestExcelProcessor.test_process_file_with_schemas _______________
tests/arb/utils/excel/test_processing_layer.py:160: in test_process_file_with_schemas
    assert result.success is True
E   AssertionError: assert False is True
E    +  where False = ExcelParseResult(success=False, metadata={}, schemas={}, tab_contents={}, validation_results=[ValidationResult(field_name='file_path', is_valid=True, message='File path is valid and accessible: /tmp/tmpidfeydhb/test.xlsx', severity='INFO', location='/tmp/tmpidfeydhb/test.xlsx', context={}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 932766)), ValidationResult(field_name='file_format', is_valid=True, message='File format is valid: .xlsx', severity='INFO', location='/tmp/tmpidfeydhb/test.xlsx', context={'file_extension': '.xlsx'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 932829)), ValidationResult(field_name='file_size', is_valid=True, message='File size 0.00MB is within limits', severity='INFO', location='/tmp/tmpidfeydhb/test.xlsx', context={'file_size_mb': 0.0020303726196289062, 'max_size_mb': 10, 'file_size_bytes': 2129}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 932837)), ValidationResult(field_name='workbook_loading', is_valid=False, message='Failed to load workbook for validation: unbound prefix: line 4, column 8', severity='ERROR', location='/tmp/tmpidfeydhb/test.xlsx', context={'exception': 'unbound prefix: line 4, column 8'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 933402))], processing_stats=ProcessingStats(start_time=1755140171.9327466, end_time=1755140171.9339826, rows_processed=0, cells_processed=0, tabs_processed=0, fields_processed=0, validation_errors=1, processing_errors=0, warnings=0, memory_usage_mb=0.0), errors=['Failed to load workbook', 'Failed to load workbook for validation: unbound prefix: line 4, column 8'], warnings=[], file_path=PosixPath('/tmp/tmpidfeydhb/test.xlsx'), processing_time=0.0012359619140625, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 933987)).success
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: unbound prefix: line 4, column 8
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpidfeydhb/test.xlsx, error: unbound prefix: line 4, column 8
___________ TestExcelProcessor.test_process_file_with_required_tabs ____________
tests/arb/utils/excel/test_processing_layer.py:177: in test_process_file_with_required_tabs
    assert result.success is True
E   AssertionError: assert False is True
E    +  where False = ExcelParseResult(success=False, metadata={}, schemas={}, tab_contents={}, validation_results=[ValidationResult(field_name='file_path', is_valid=True, message='File path is valid and accessible: /tmp/tmpicjdwt2x/test.xlsx', severity='INFO', location='/tmp/tmpicjdwt2x/test.xlsx', context={}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 937617)), ValidationResult(field_name='file_format', is_valid=True, message='File format is valid: .xlsx', severity='INFO', location='/tmp/tmpicjdwt2x/test.xlsx', context={'file_extension': '.xlsx'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 937671)), ValidationResult(field_name='file_size', is_valid=True, message='File size 0.00MB is within limits', severity='INFO', location='/tmp/tmpicjdwt2x/test.xlsx', context={'file_size_mb': 0.0020303726196289062, 'max_size_mb': 10, 'file_size_bytes': 2129}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 937680)), ValidationResult(field_name='workbook_loading', is_valid=False, message='Failed to load workbook for validation: unbound prefix: line 4, column 8', severity='ERROR', location='/tmp/tmpicjdwt2x/test.xlsx', context={'exception': 'unbound prefix: line 4, column 8'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 938198))], processing_stats=ProcessingStats(start_time=1755140171.9376013, end_time=1755140171.938669, rows_processed=0, cells_processed=0, tabs_processed=0, fields_processed=0, validation_errors=1, processing_errors=0, warnings=0, memory_usage_mb=0.0), errors=['Failed to load workbook', 'Failed to load workbook for validation: unbound prefix: line 4, column 8'], warnings=[], file_path=PosixPath('/tmp/tmpicjdwt2x/test.xlsx'), processing_time=0.0010676383972167969, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 938674)).success
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: unbound prefix: line 4, column 8
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpicjdwt2x/test.xlsx, error: unbound prefix: line 4, column 8
_______________ TestExcelProcessor.test_process_file_nonexistent _______________
tests/arb/utils/excel/test_processing_layer.py:187: in test_process_file_nonexistent
    assert "does not exist" in result.errors[0] or "File validation failed" in result.errors[0]
E   AssertionError: assert ('does not exist' in 'Failed to load workbook' or 'File validation failed' in 'Failed to load workbook')
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: file_path: File does not exist: /tmp/tmpa8feqs_s/nonexistent.xlsx
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: file_format: File format validation error: [Errno 2] No such file or directory: '/tmp/tmpa8feqs_s/nonexistent.xlsx'
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: file_size: File size validation error: [Errno 2] No such file or directory: '/tmp/tmpa8feqs_s/nonexistent.xlsx'
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpa8feqs_s/nonexistent.xlsx, error: [Errno 2] No such file or directory: '/tmp/tmpa8feqs_s/nonexistent.xlsx'
________________ TestExcelProcessor.test_processing_statistics _________________
tests/arb/utils/excel/test_processing_layer.py:301: in test_processing_statistics
    assert stats.tabs_processed > 0
E   assert 0 > 0
E    +  where 0 = ProcessingStats(start_time=1755140171.9637694, end_time=1755140171.9653394, rows_processed=0, cells_processed=0, tabs_processed=0, fields_processed=0, validation_errors=1, processing_errors=0, warnings=0, memory_usage_mb=0.0).tabs_processed
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: unbound prefix: line 4, column 8
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpebh8v8a5/test.xlsx, error: unbound prefix: line 4, column 8
________________ TestExcelProcessor.test_validation_integration ________________
tests/arb/utils/excel/test_processing_layer.py:317: in test_validation_integration
    assert len(errors) == 0, f"Unexpected errors: {[e.message for e in errors]}"
E   AssertionError: Unexpected errors: ['Failed to load workbook for validation: unbound prefix: line 4, column 8']
E   assert 1 == 0
E    +  where 1 = len([ValidationResult(field_name='workbook_loading', is_valid=False, message='Failed to load workbook for validation: unbound prefix: line 4, column 8', severity='ERROR', location='/tmp/tmpp4gg443z/test.xlsx', context={'exception': 'unbound prefix: line 4, column 8'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 970863))])
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: unbound prefix: line 4, column 8
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpp4gg443z/test.xlsx, error: unbound prefix: line 4, column 8
___________________ TestExcelProcessor.test_workbook_cleanup ___________________
tests/arb/utils/excel/test_processing_layer.py:337: in test_workbook_cleanup
    assert result.success is True
E   AssertionError: assert False is True
E    +  where False = ExcelParseResult(success=False, metadata={}, schemas={}, tab_contents={}, validation_results=[ValidationResult(field_name='file_path', is_valid=True, message='File path is valid and accessible: /tmp/tmp7_9d_8xt/test.xlsx', severity='INFO', location='/tmp/tmp7_9d_8xt/test.xlsx', context={}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 977300)), ValidationResult(field_name='file_format', is_valid=True, message='File format is valid: .xlsx', severity='INFO', location='/tmp/tmp7_9d_8xt/test.xlsx', context={'file_extension': '.xlsx'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 977359)), ValidationResult(field_name='file_size', is_valid=True, message='File size 0.00MB is within limits', severity='INFO', location='/tmp/tmp7_9d_8xt/test.xlsx', context={'file_size_mb': 0.0020303726196289062, 'max_size_mb': 10, 'file_size_bytes': 2129}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 977367)), ValidationResult(field_name='workbook_loading', is_valid=False, message='Failed to load workbook for validation: unbound prefix: line 4, column 8', severity='ERROR', location='/tmp/tmp7_9d_8xt/test.xlsx', context={'exception': 'unbound prefix: line 4, column 8'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 978096))], processing_stats=ProcessingStats(start_time=1755140171.9772856, end_time=1755140171.9786174, rows_processed=0, cells_processed=0, tabs_processed=0, fields_processed=0, validation_errors=1, processing_errors=0, warnings=0, memory_usage_mb=0.0), errors=['Failed to load workbook', 'Failed to load workbook for validation: unbound prefix: line 4, column 8'], warnings=[], file_path=PosixPath('/tmp/tmp7_9d_8xt/test.xlsx'), processing_time=0.0013318061828613281, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 978623)).success
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: unbound prefix: line 4, column 8
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmp7_9d_8xt/test.xlsx, error: unbound prefix: line 4, column 8
________ TestProcessingIntegration.test_end_to_end_processing_workflow _________
tests/arb/utils/excel/test_processing_layer.py:409: in test_end_to_end_processing_workflow
    assert result.success is True
E   AssertionError: assert False is True
E    +  where False = ExcelParseResult(success=False, metadata={}, schemas={}, tab_contents={}, validation_results=[ValidationResult(field_name='file_path', is_valid=True, message='File path is valid and accessible: /tmp/tmpbq46v9xn/test.xlsx', severity='INFO', location='/tmp/tmpbq46v9xn/test.xlsx', context={}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 983552)), ValidationResult(field_name='file_format', is_valid=True, message='File format is valid: .xlsx', severity='INFO', location='/tmp/tmpbq46v9xn/test.xlsx', context={'file_extension': '.xlsx'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 983608)), ValidationResult(field_name='file_size', is_valid=True, message='File size 0.00MB is within limits', severity='INFO', location='/tmp/tmpbq46v9xn/test.xlsx', context={'file_size_mb': 0.0019273757934570312, 'max_size_mb': 100, 'file_size_bytes': 2021}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 983618)), ValidationResult(field_name='workbook_loading', is_valid=False, message='Failed to load workbook for validation: unbound prefix: line 4, column 8', severity='ERROR', location='/tmp/tmpbq46v9xn/test.xlsx', context={'exception': 'unbound prefix: line 4, column 8'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 984292))], processing_stats=ProcessingStats(start_time=1755140171.983535, end_time=1755140171.984818, rows_processed=0, cells_processed=0, tabs_processed=0, fields_processed=0, validation_errors=1, processing_errors=0, warnings=0, memory_usage_mb=0.0), errors=['Failed to load workbook', 'Failed to load workbook for validation: unbound prefix: line 4, column 8'], warnings=[], file_path=PosixPath('/tmp/tmpbq46v9xn/test.xlsx'), processing_time=0.0012829303741455078, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 984823)).success
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: unbound prefix: line 4, column 8
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpbq46v9xn/test.xlsx, error: unbound prefix: line 4, column 8
_____________ TestProcessingIntegration.test_configuration_impact ______________
tests/arb/utils/excel/test_processing_layer.py:449: in test_configuration_impact
    assert small_result.success is True
E   AssertionError: assert False is True
E    +  where False = ExcelParseResult(success=False, metadata={}, schemas={}, tab_contents={}, validation_results=[ValidationResult(field_name='file_path', is_valid=True, message='File path is valid and accessible: /tmp/tmpls_ho01l/test.xlsx', severity='INFO', location='/tmp/tmpls_ho01l/test.xlsx', context={}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 988596)), ValidationResult(field_name='file_format', is_valid=True, message='File format is valid: .xlsx', severity='INFO', location='/tmp/tmpls_ho01l/test.xlsx', context={'file_extension': '.xlsx'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 988642)), ValidationResult(field_name='file_size', is_valid=True, message='File size 0.00MB is within limits', severity='INFO', location='/tmp/tmpls_ho01l/test.xlsx', context={'file_size_mb': 0.0006084442138671875, 'max_size_mb': 1, 'file_size_bytes': 638}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 988652)), ValidationResult(field_name='workbook_loading', is_valid=False, message='Failed to load workbook for validation: File contains no valid workbook part', severity='ERROR', location='/tmp/tmpls_ho01l/test.xlsx', context={'exception': 'File contains no valid workbook part'}, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 988767))], processing_stats=ProcessingStats(start_time=1755140171.9885824, end_time=1755140171.988908, rows_processed=0, cells_processed=0, tabs_processed=0, fields_processed=0, validation_errors=1, processing_errors=0, warnings=0, memory_usage_mb=0.0), errors=['Failed to load workbook', 'Failed to load workbook for validation: File contains no valid workbook part'], warnings=[], file_path=PosixPath('/tmp/tmpls_ho01l/test.xlsx'), processing_time=0.0003256797790527344, timestamp=datetime.datetime(2025, 8, 13, 19, 56, 11, 988913)).success
------------------------------ Captured log call -------------------------------
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: File contains no valid workbook part
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpls_ho01l/test.xlsx, error: File contains no valid workbook part
WARNING  arb.utils.excel.processing.excel_processor:excel_processor.py:224 Validation failed: workbook_loading: Failed to load workbook for validation: File contains no valid workbook part
ERROR    arb.utils.excel.processing.excel_processor:excel_processor.py:280 Failed to load workbook: /tmp/tmpls_ho01l/test.xlsx, error: File contains no valid workbook part
=========================== short test summary info ============================
FAILED tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_basic
FAILED tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_with_schemas
FAILED tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_with_required_tabs
FAILED tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_process_file_nonexistent
FAILED tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_processing_statistics
FAILED tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_validation_integration
FAILED tests/arb/utils/excel/test_processing_layer.py::TestExcelProcessor::test_workbook_cleanup
FAILED tests/arb/utils/excel/test_processing_layer.py::TestProcessingIntegration::test_end_to_end_processing_workflow
FAILED tests/arb/utils/excel/test_processing_layer.py::TestProcessingIntegration::test_configuration_impact
========================= 9 failed, 8 passed in 0.31s ==========================
