<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://tony-held-carb.github.io/reference/arb/utils/json/" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>arb.utils.json - CalSMP Operator Feedback Portal</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "arb.utils.json";
        var mkdocs_page_input_path = "reference\\arb\\utils\\json.md";
        var mkdocs_page_url = "/reference/arb/utils/json/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> CalSMP Operator Feedback Portal
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../..">Welcome &amp; Instructions</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Arb</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../wsgi/">arb.wsgi</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Auth</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/default_settings/">arb.auth.default_settings</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/email_util/">arb.auth.email_util</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/forms/">arb.auth.forms</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/login_manager/">arb.auth.login_manager</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/migrate_roles/">arb.auth.migrate_roles</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/models/">arb.auth.models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/okta_settings/">arb.auth.okta_settings</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/role_decorators/">arb.auth.role_decorators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/role_examples/">arb.auth.role_examples</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/routes/">arb.auth.routes</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth/test_auth/">arb.auth.test_auth</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Auth example app</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../auth_example_app/app/">arb.auth_example_app.app</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth_example_app/config/">arb.auth_example_app.config</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth_example_app/extensions/">arb.auth_example_app.extensions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../auth_example_app/wsgi/">arb.auth_example_app.wsgi</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Routes</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../auth_example_app/routes/admin/">arb.auth_example_app.routes.admin</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../auth_example_app/routes/main/">arb.auth_example_app.routes.main</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../auth_example_app/routes/user_management/">arb.auth_example_app.routes.user_management</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Logging</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../logging/arb_logging/">arb.logging.arb_logging</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Portal</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/app/">arb.portal.app</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/constants/">arb.portal.constants</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/db_hardcoded/">arb.portal.db_hardcoded</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/extensions/">arb.portal.extensions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/globals/">arb.portal.globals</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/json_update_util/">arb.portal.json_update_util</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/routes/">arb.portal.routes</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/sqla_models/">arb.portal.sqla_models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/wtf_landfill/">arb.portal.wtf_landfill</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/wtf_oil_and_gas/">arb.portal.wtf_oil_and_gas</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../portal/wtf_upload/">arb.portal.wtf_upload</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Config</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/config/accessors/">arb.portal.config.accessors</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/config/settings/">arb.portal.config.settings</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Startup</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/startup/db/">arb.portal.startup.db</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/startup/flask/">arb.portal.startup.flask</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/startup/runtime_info/">arb.portal.startup.runtime_info</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Utils</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/db_ingest_util/">arb.portal.utils.db_ingest_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/db_introspection_util/">arb.portal.utils.db_introspection_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/file_upload_util/">arb.portal.utils.file_upload_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/form_mapper/">arb.portal.utils.form_mapper</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/github_and_ai/">arb.portal.utils.github_and_ai</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/import_audit/">arb.portal.utils.import_audit</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/route_util/">arb.portal.utils.route_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/sector_util/">arb.portal.utils.sector_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../portal/utils/test_cleanup_util/">arb.portal.utils.test_cleanup_util</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >Utils</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../constants/">arb.utils.constants</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../database/">arb.utils.database</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../date_and_time/">arb.utils.date_and_time</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../diagnostics/">arb.utils.diagnostics</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../file_io/">arb.utils.file_io</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../io_wrappers/">arb.utils.io_wrappers</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">arb.utils.json</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json">json</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.add_metadata_to_json">add_metadata_to_json</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.cast_model_value">cast_model_value</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.compare_json_files">compare_json_files</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.compute_field_differences">compute_field_differences</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.deserialize_dict">deserialize_dict</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.extract_id_from_json">extract_id_from_json</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.extract_tab_payload">extract_tab_payload</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.json_deserializer">json_deserializer</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.json_load">json_load</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.json_load_with_meta">json_load_with_meta</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.json_save">json_save</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.json_save_with_meta">json_save_with_meta</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.json_serializer">json_serializer</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.make_dict_serializeable">make_dict_serializeable</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.normalize_value">normalize_value</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.safe_json_loads">safe_json_loads</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.utils.json.wtform_types_and_values">wtform_types_and_values</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../log_util/">arb.utils.log_util</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../misc/">arb.utils.misc</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../sql_alchemy/">arb.utils.sql_alchemy</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../web_html/">arb.utils.web_html</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../wtf_forms_util/">arb.utils.wtf_forms_util</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Excel</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../excel/excel_compare/">arb.utils.excel.excel_compare</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../excel/excel_compare_04/">arb.utils.excel.excel_compare_04</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../excel/xl_create/">arb.utils.excel.xl_create</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../excel/xl_file_structure/">arb.utils.excel.xl_file_structure</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../excel/xl_hardcoded/">arb.utils.excel.xl_hardcoded</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../excel/xl_misc/">arb.utils.excel.xl_misc</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../excel/xl_parse/">arb.utils.excel.xl_parse</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">CalSMP Operator Feedback Portal</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Reference</li>
          <li class="breadcrumb-item">Arb</li>
          <li class="breadcrumb-item">Utils</li>
      <li class="breadcrumb-item active">arb.utils.json</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="arbutilsjson"><code>arb.utils.json</code></h1>


<div class="doc doc-object doc-module">



<a id="arb.utils.json"></a>
    <div class="doc doc-contents first">

        <p>JSON utilities for the ARB Feedback Portal.</p>
<p>This module centralizes JSON serialization, deserialization, metadata handling, and diagnostics for
ARB portal utilities. It ensures consistent handling of ISO 8601 datetimes, decimals, and custom types,
and provides helpers for file-based workflows, WTForms integration, and contract-compliant value
normalization.</p>
<p>Features:
- Custom serialization/deserialization for datetime, decimal, and class/type objects
- Metadata support for enhanced JSON files (with <em>data</em> and <em>metadata</em> fields)
- File-based diagnostics, JSON comparison, and safe file I/O
- WTForms integration for extracting and casting form data
- Value normalization and diffing for ingestion and audit workflows</p>
<p>Contract notes:
- Emphasizes ISO 8601 datetime formats and Pacific Time handling where required
- Designed for robust, structured JSON handling across ARB portal utilities
- Logging is used for diagnostics, warnings, and error reporting</p>
<p>Extensible for new types and workflows as the portal evolves.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.add_metadata_to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_metadata_to_json</span><span class="p">(</span><span class="n">file_name_in</span><span class="p">,</span> <span class="n">file_name_out</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add metadata to an existing JSON file or overwrite it in-place.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_name_in</code></b>
                  (<code><span title="str">str</span> | <span title="Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Input JSON file path. If None or empty, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>file_name_out</code></b>
                  (<code><span title="str">str</span> | <span title="Path">Path</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Output file path. If None, overwrites input. If empty, raises ValueError.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>None</code>
              –
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If file_name_in is None or empty, or if file_name_out is empty.</p>
              </div>
            </li>
            <li>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
              –
              <div class="doc-md-description">
                <p>If the input file does not exist.</p>
              </div>
            </li>
            <li>
                  <code><span title="OSError">OSError</span></code>
              –
              <div class="doc-md-description">
                <p>If the file cannot be written.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : "schema.json"
Output: Adds metadata and writes back to same file
Input : "input.json", "output.json"
Output: Adds metadata and writes to output.json</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If file_name_out is None, input file is overwritten.</li>
<li>If file_name_in or file_name_out is empty, raises ValueError.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_metadata_to_json</span><span class="p">(</span>
    <span class="n">file_name_in</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">file_name_out</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Add metadata to an existing JSON file or overwrite it in-place.</span>

<span class="sd">  Args:</span>
<span class="sd">    file_name_in (str | Path): Input JSON file path. If None or empty, raises ValueError.</span>
<span class="sd">    file_name_out (str | Path | None): Output file path. If None, overwrites input. If empty, raises ValueError.</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If file_name_in is None or empty, or if file_name_out is empty.</span>
<span class="sd">    FileNotFoundError: If the input file does not exist.</span>
<span class="sd">    OSError: If the file cannot be written.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : &quot;schema.json&quot;</span>
<span class="sd">    Output: Adds metadata and writes back to same file</span>
<span class="sd">    Input : &quot;input.json&quot;, &quot;output.json&quot;</span>
<span class="sd">    Output: Adds metadata and writes to output.json</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If file_name_out is None, input file is overwritten.</span>
<span class="sd">    - If file_name_in or file_name_out is empty, raises ValueError.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;add_metadata_to_json() called with </span><span class="si">{</span><span class="n">file_name_in</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">file_name_out</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="n">file_name_in</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file_name_in</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file_name_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">file_name_out</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file_name_out</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">file_name_out</span> <span class="o">=</span> <span class="n">file_name_in</span>

  <span class="n">data</span> <span class="o">=</span> <span class="n">json_load</span><span class="p">(</span><span class="n">file_name_in</span><span class="p">)</span>
  <span class="n">json_save_with_meta</span><span class="p">(</span><span class="n">file_name_out</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.cast_model_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cast_model_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">convert_time_to_ca</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Cast a stringified JSON value into a Python object of the expected type.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>value</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>Input value to cast. If None, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>value_type</code></b>
                  (<code><span title="type">type</span></code>)
              –
              <div class="doc-md-description">
                <p>Python type to cast to (str, int, float, bool, datetime, decimal). If None, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>convert_time_to_ca</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True, convert UTC to California naive datetime.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Any</code></b>(                  <code><span title="typing.Any">Any</span></code>
)              –
              <div class="doc-md-description">
                <p>Value converted to the target Python type.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If the value cannot be cast to the given type, type is unsupported, or value_type is None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : "2025-01-01T12:00:00Z", datetime.datetime
Output: datetime.datetime(2025, 1, 1, 12, 0, 0, tzinfo=ZoneInfo("UTC"))
Input : "123.45", decimal.Decimal
Output: decimal.Decimal("123.45")
Input : "true", bool
Output: True</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If value_type is None, raises ValueError.</li>
<li>If value is None, raises ValueError.</li>
<li>If type is unsupported, raises ValueError.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cast_model_value</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">value_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span>
    <span class="n">convert_time_to_ca</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Cast a stringified JSON value into a Python object of the expected type.</span>

<span class="sd">  Args:</span>
<span class="sd">    value (str): Input value to cast. If None, raises ValueError.</span>
<span class="sd">    value_type (type): Python type to cast to (str, int, float, bool, datetime, decimal). If None, raises ValueError.</span>
<span class="sd">    convert_time_to_ca (bool): If True, convert UTC to California naive datetime.</span>

<span class="sd">  Returns:</span>
<span class="sd">    Any: Value converted to the target Python type.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If the value cannot be cast to the given type, type is unsupported, or value_type is None.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : &quot;2025-01-01T12:00:00Z&quot;, datetime.datetime</span>
<span class="sd">    Output: datetime.datetime(2025, 1, 1, 12, 0, 0, tzinfo=ZoneInfo(&quot;UTC&quot;))</span>
<span class="sd">    Input : &quot;123.45&quot;, decimal.Decimal</span>
<span class="sd">    Output: decimal.Decimal(&quot;123.45&quot;)</span>
<span class="sd">    Input : &quot;true&quot;, bool</span>
<span class="sd">    Output: True</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If value_type is None, raises ValueError.</span>
<span class="sd">    - If value is None, raises ValueError.</span>
<span class="sd">    - If type is unsupported, raises ValueError.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># todo - datetime - may need to update</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">value_type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
      <span class="c1"># No need to cast a string</span>
      <span class="k">return</span> <span class="n">value</span>
    <span class="k">elif</span> <span class="n">value_type</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
      <span class="k">return</span> <span class="n">value_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">value_type</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
      <span class="n">dt</span> <span class="o">=</span> <span class="n">iso_str_to_utc_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">utc_datetime_to_ca_naive_datetime</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">if</span> <span class="n">convert_time_to_ca</span> <span class="k">else</span> <span class="n">dt</span>
    <span class="k">elif</span> <span class="n">value_type</span> <span class="o">==</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported type for casting: </span><span class="si">{</span><span class="n">value_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to cast </span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s2"> to </span><span class="si">{</span><span class="n">value_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.compare_json_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compare_json_files</span><span class="p">(</span><span class="n">file_name_1</span><span class="p">,</span> <span class="n">file_name_2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compare the contents of two JSON files including metadata and values.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_name_1</code></b>
                  (<code><span title="str">str</span> | <span title="Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Path to the first file. If None or empty, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>file_name_2</code></b>
                  (<code><span title="str">str</span> | <span title="Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Path to the second file. If None or empty, raises ValueError.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>None</code>
              –
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="logs" open>
  <summary>Logs</summary>
  <p>Differences or matches are logged at debug level.</p>
</details>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If file_name_1 or file_name_2 is None or empty.</p>
              </div>
            </li>
            <li>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
              –
              <div class="doc-md-description">
                <p>If either file does not exist.</p>
              </div>
            </li>
            <li>
                  <code><span title="json.JSONDecodeError">JSONDecodeError</span></code>
              –
              <div class="doc-md-description">
                <p>If either file is not valid JSON.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : "old.json", "new.json"
Output: Logs any differences or confirms matches</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If either file is missing or invalid, raises an exception.</li>
<li>Only logs differences; does not return a value.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_json_files</span><span class="p">(</span>
    <span class="n">file_name_1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">file_name_2</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Compare the contents of two JSON files including metadata and values.</span>

<span class="sd">  Args:</span>
<span class="sd">    file_name_1 (str | Path): Path to the first file. If None or empty, raises ValueError.</span>
<span class="sd">    file_name_2 (str | Path): Path to the second file. If None or empty, raises ValueError.</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>

<span class="sd">  Logs:</span>
<span class="sd">    Differences or matches are logged at debug level.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If file_name_1 or file_name_2 is None or empty.</span>
<span class="sd">    FileNotFoundError: If either file does not exist.</span>
<span class="sd">    json.JSONDecodeError: If either file is not valid JSON.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : &quot;old.json&quot;, &quot;new.json&quot;</span>
<span class="sd">    Output: Logs any differences or confirms matches</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If either file is missing or invalid, raises an exception.</span>
<span class="sd">    - Only logs differences; does not return a value.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compare_json_files() comparing </span><span class="si">{</span><span class="n">file_name_1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">file_name_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="n">data_1</span><span class="p">,</span> <span class="n">meta_1</span> <span class="o">=</span> <span class="n">json_load_with_meta</span><span class="p">(</span><span class="n">file_name_1</span><span class="p">)</span>
  <span class="n">data_2</span><span class="p">,</span> <span class="n">meta_2</span> <span class="o">=</span> <span class="n">json_load_with_meta</span><span class="p">(</span><span class="n">file_name_2</span><span class="p">)</span>

  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Comparing metadata&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">compare_dicts</span><span class="p">(</span><span class="n">meta_1</span><span class="p">,</span> <span class="n">meta_2</span><span class="p">,</span> <span class="s2">&quot;metadata_01&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata_02&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata are equivalent&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata differ&quot;</span><span class="p">)</span>

  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Comparing data&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">compare_dicts</span><span class="p">(</span><span class="n">data_1</span><span class="p">,</span> <span class="n">data_2</span><span class="p">,</span> <span class="s2">&quot;data_01&quot;</span><span class="p">,</span> <span class="s2">&quot;data_02&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data are equivalent&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data differ&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.compute_field_differences" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_field_differences</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">existing_data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate a field-by-field diff between two dictionaries using keys from <code>new_data</code>.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>new_data</code></b>
                  (<code><span title="dict">dict</span></code>)
              –
              <div class="doc-md-description">
                <p>The incoming or modified dictionary (e.g., staged JSON). If None, treated as empty dict.</p>
              </div>
            </li>
            <li>
              <b><code>existing_data</code></b>
                  (<code><span title="dict">dict</span></code>)
              –
              <div class="doc-md-description">
                <p>The reference or baseline dictionary (e.g., DB row). If None, treated as empty dict.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
              –
              <div class="doc-md-description">
                <p>list[dict]: List of field diffs, each with:
- 'key': The dictionary key being compared
- 'old': The normalized value from <code>existing_data</code>
- 'new': The normalized value from <code>new_data</code>
- 'changed': True if the values differ after normalization
- 'is_same': True if values are unchanged
- 'from_upload': Always True, indicating this field came from uploaded JSON
- 'requires_confirmation': True if the update adds or overwrites non-trivial data</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : {"a": 1}, {"a": 2}
Output: [{"key": "a", "old": "2", "new": "1", "changed": True, ...}]
Input : {"a": None}, {"a": ""}
Output: [{"key": "a", "old": "", "new": "", "changed": False, ...}]</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Normalization uses <code>normalize_value()</code> for consistent formatting, especially for empty strings, None, and datetimes.</li>
<li>Keys present in <code>existing_data</code> but <em>not</em> in <code>new_data</code> are ignored.</li>
<li>A field requires confirmation if it adds or overwrites non-empty data.</li>
<li>If either input dict is None, it is treated as empty dict.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_field_differences</span><span class="p">(</span>
    <span class="n">new_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">existing_data</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Generate a field-by-field diff between two dictionaries using keys from `new_data`.</span>

<span class="sd">  Args:</span>
<span class="sd">    new_data (dict): The incoming or modified dictionary (e.g., staged JSON). If None, treated as empty dict.</span>
<span class="sd">    existing_data (dict): The reference or baseline dictionary (e.g., DB row). If None, treated as empty dict.</span>

<span class="sd">  Returns:</span>
<span class="sd">    list[dict]: List of field diffs, each with:</span>
<span class="sd">      - &#39;key&#39;: The dictionary key being compared</span>
<span class="sd">      - &#39;old&#39;: The normalized value from `existing_data`</span>
<span class="sd">      - &#39;new&#39;: The normalized value from `new_data`</span>
<span class="sd">      - &#39;changed&#39;: True if the values differ after normalization</span>
<span class="sd">      - &#39;is_same&#39;: True if values are unchanged</span>
<span class="sd">      - &#39;from_upload&#39;: Always True, indicating this field came from uploaded JSON</span>
<span class="sd">      - &#39;requires_confirmation&#39;: True if the update adds or overwrites non-trivial data</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : {&quot;a&quot;: 1}, {&quot;a&quot;: 2}</span>
<span class="sd">    Output: [{&quot;key&quot;: &quot;a&quot;, &quot;old&quot;: &quot;2&quot;, &quot;new&quot;: &quot;1&quot;, &quot;changed&quot;: True, ...}]</span>
<span class="sd">    Input : {&quot;a&quot;: None}, {&quot;a&quot;: &quot;&quot;}</span>
<span class="sd">    Output: [{&quot;key&quot;: &quot;a&quot;, &quot;old&quot;: &quot;&quot;, &quot;new&quot;: &quot;&quot;, &quot;changed&quot;: False, ...}]</span>

<span class="sd">  Notes:</span>
<span class="sd">    - Normalization uses `normalize_value()` for consistent formatting, especially for empty strings, None, and datetimes.</span>
<span class="sd">    - Keys present in `existing_data` but *not* in `new_data` are ignored.</span>
<span class="sd">    - A field requires confirmation if it adds or overwrites non-empty data.</span>
<span class="sd">    - If either input dict is None, it is treated as empty dict.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">differences</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">new_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">new_value</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">old_value</span> <span class="o">=</span> <span class="n">existing_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">norm_new</span> <span class="o">=</span> <span class="n">normalize_value</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>
    <span class="n">norm_old</span> <span class="o">=</span> <span class="n">normalize_value</span><span class="p">(</span><span class="n">old_value</span><span class="p">)</span>

    <span class="n">is_same</span> <span class="o">=</span> <span class="n">norm_old</span> <span class="o">==</span> <span class="n">norm_new</span>
    <span class="n">requires_confirmation</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">norm_new</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_same</span>
    <span class="p">)</span>

    <span class="n">differences</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
      <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
      <span class="s2">&quot;old&quot;</span><span class="p">:</span> <span class="n">norm_old</span><span class="p">,</span>
      <span class="s2">&quot;new&quot;</span><span class="p">:</span> <span class="n">norm_new</span><span class="p">,</span>
      <span class="s2">&quot;changed&quot;</span><span class="p">:</span> <span class="ow">not</span> <span class="n">is_same</span><span class="p">,</span>
      <span class="s2">&quot;is_same&quot;</span><span class="p">:</span> <span class="n">is_same</span><span class="p">,</span>
      <span class="s2">&quot;from_upload&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
      <span class="s2">&quot;requires_confirmation&quot;</span><span class="p">:</span> <span class="n">requires_confirmation</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DIFF KEY=</span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2"> | DB=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">old_value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">norm_old</span><span class="si">!r}</span><span class="s2"> &quot;</span>
                 <span class="sa">f</span><span class="s2">&quot;| NEW=</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">norm_new</span><span class="si">!r}</span><span class="s2"> &quot;</span>
                 <span class="sa">f</span><span class="s2">&quot;| SAME=</span><span class="si">{</span><span class="n">is_same</span><span class="si">}</span><span class="s2"> | CONFIRM=</span><span class="si">{</span><span class="n">requires_confirmation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">differences</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.deserialize_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">deserialize_dict</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">type_map</span><span class="p">,</span> <span class="n">convert_time_to_ca</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Deserialize a dictionary of raw values using a type map.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>input_dict</code></b>
                  (<code><span title="dict">dict</span></code>)
              –
              <div class="doc-md-description">
                <p>Dictionary of raw values. If None, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>type_map</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="type">type</span>]</code>)
              –
              <div class="doc-md-description">
                <p>Field-to-type mapping for deserialization. If None or empty, no casting is performed.</p>
              </div>
            </li>
            <li>
              <b><code>convert_time_to_ca</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True, converts datetime to CA time.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>Fully deserialized dictionary.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="TypeError">TypeError</span></code>
              –
              <div class="doc-md-description">
                <p>If any key is not a string.</p>
              </div>
            </li>
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If value casting fails for a key or if input_dict is None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : {"dt": "2025-01-01T12:00:00Z"}, {"dt": datetime.datetime}
Output: {"dt": datetime.datetime(2025, 1, 1, 12, 0, 0, tzinfo=ZoneInfo("UTC"))}</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If input_dict is None, raises ValueError.</li>
<li>If type_map is None or empty, no casting is performed.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">deserialize_dict</span><span class="p">(</span>
    <span class="n">input_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">type_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
    <span class="n">convert_time_to_ca</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Deserialize a dictionary of raw values using a type map.</span>

<span class="sd">  Args:</span>
<span class="sd">    input_dict (dict): Dictionary of raw values. If None, raises ValueError.</span>
<span class="sd">    type_map (dict[str, type]): Field-to-type mapping for deserialization. If None or empty, no casting is performed.</span>
<span class="sd">    convert_time_to_ca (bool): If True, converts datetime to CA time.</span>

<span class="sd">  Returns:</span>
<span class="sd">    dict: Fully deserialized dictionary.</span>

<span class="sd">  Raises:</span>
<span class="sd">    TypeError: If any key is not a string.</span>
<span class="sd">    ValueError: If value casting fails for a key or if input_dict is None.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : {&quot;dt&quot;: &quot;2025-01-01T12:00:00Z&quot;}, {&quot;dt&quot;: datetime.datetime}</span>
<span class="sd">    Output: {&quot;dt&quot;: datetime.datetime(2025, 1, 1, 12, 0, 0, tzinfo=ZoneInfo(&quot;UTC&quot;))}</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If input_dict is None, raises ValueError.</span>
<span class="sd">    - If type_map is None or empty, no casting is performed.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All keys must be strings. Invalid key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">type_map</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast_model_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">type_map</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">convert_time_to_ca</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

  <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.extract_id_from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_id_from_json</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">tab_name</span><span class="o">=</span><span class="s1">&#39;Feedback Form&#39;</span><span class="p">,</span> <span class="n">key_name</span><span class="o">=</span><span class="s1">&#39;id_incidence&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Safely extract a numeric key (like id_incidence) from a specified tab in Excel-parsed JSON.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>json_data</code></b>
                  (<code><span title="dict">dict</span></code>)
              –
              <div class="doc-md-description">
                <p>JSON dictionary as parsed from the Excel upload. If None, returns None.</p>
              </div>
            </li>
            <li>
              <b><code>tab_name</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;Feedback Form&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Name of the tab in 'tab_contents'. Defaults to "Feedback Form". If None or empty, uses default.</p>
              </div>
            </li>
            <li>
              <b><code>key_name</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;id_incidence&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Key to extract from the tab. Defaults to "id_incidence". If None or empty, uses default.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="int">int</span> | None</code>
              –
              <div class="doc-md-description">
                <p>int | None: Parsed integer value, or None if not found or invalid.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : {"tab_contents": {"Feedback Form": {"id_incidence": "123"}}}, tab_name="Feedback Form", key_name="id_incidence"
Output: 123
Input : {"tab_contents": {"Feedback Form": {}}}, tab_name="Feedback Form", key_name="id_incidence"
Output: None</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Unlike full ingestion, this does not validate schema or write to the DB.</li>
<li>Handles string digits and trims whitespace safely.</li>
<li>Logs warning if structure is invalid.</li>
<li>If json_data is None, returns None.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_id_from_json</span><span class="p">(</span><span class="n">json_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                         <span class="n">tab_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Feedback Form&quot;</span><span class="p">,</span>
                         <span class="n">key_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;id_incidence&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Safely extract a numeric key (like id_incidence) from a specified tab in Excel-parsed JSON.</span>

<span class="sd">  Args:</span>
<span class="sd">    json_data (dict): JSON dictionary as parsed from the Excel upload. If None, returns None.</span>
<span class="sd">    tab_name (str, optional): Name of the tab in &#39;tab_contents&#39;. Defaults to &quot;Feedback Form&quot;. If None or empty, uses default.</span>
<span class="sd">    key_name (str, optional): Key to extract from the tab. Defaults to &quot;id_incidence&quot;. If None or empty, uses default.</span>

<span class="sd">  Returns:</span>
<span class="sd">    int | None: Parsed integer value, or None if not found or invalid.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : {&quot;tab_contents&quot;: {&quot;Feedback Form&quot;: {&quot;id_incidence&quot;: &quot;123&quot;}}}, tab_name=&quot;Feedback Form&quot;, key_name=&quot;id_incidence&quot;</span>
<span class="sd">    Output: 123</span>
<span class="sd">    Input : {&quot;tab_contents&quot;: {&quot;Feedback Form&quot;: {}}}, tab_name=&quot;Feedback Form&quot;, key_name=&quot;id_incidence&quot;</span>
<span class="sd">    Output: None</span>

<span class="sd">  Notes:</span>
<span class="sd">    - Unlike full ingestion, this does not validate schema or write to the DB.</span>
<span class="sd">    - Handles string digits and trims whitespace safely.</span>
<span class="sd">    - Logs warning if structure is invalid.</span>
<span class="sd">    - If json_data is None, returns None.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">tab_data</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tab_contents&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tab_name</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">tab_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">val</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
      <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
  <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract key &#39;</span><span class="si">{</span><span class="n">key_name</span><span class="si">}</span><span class="s2">&#39; from tab &#39;</span><span class="si">{</span><span class="n">tab_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.extract_tab_payload" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_tab_payload</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">tab_name</span><span class="o">=</span><span class="s1">&#39;Feedback Form&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract the contents of a specific tab from a parsed Excel JSON structure.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>json_data</code></b>
                  (<code><span title="dict">dict</span></code>)
              –
              <div class="doc-md-description">
                <p>Parsed JSON dictionary, typically from <code>json_load_with_meta()</code>. If None, returns empty dict.</p>
              </div>
            </li>
            <li>
              <b><code>tab_name</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;Feedback Form&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Tab name whose contents to extract. Defaults to "Feedback Form". If None or empty, uses default.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>The dictionary of field keys/values for the specified tab, or an empty dict if the tab is missing or malformed.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : {"tab_contents": {"Feedback Form": {"field1": "value1"}}}, tab_name="Feedback Form"
Output: {"field1": "value1"}
Input : {"tab_contents": {}}, tab_name="Feedback Form"
Output: {}
Input : None, tab_name="Feedback Form"
Output: {}</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If json_data is None, returns empty dict.</li>
<li>If tab_name is None or empty, uses default.</li>
<li>If the tab is missing or malformed, returns empty dict.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_tab_payload</span><span class="p">(</span><span class="n">json_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                        <span class="n">tab_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Feedback Form&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Extract the contents of a specific tab from a parsed Excel JSON structure.</span>

<span class="sd">  Args:</span>
<span class="sd">    json_data (dict): Parsed JSON dictionary, typically from `json_load_with_meta()`. If None, returns empty dict.</span>
<span class="sd">    tab_name (str): Tab name whose contents to extract. Defaults to &quot;Feedback Form&quot;. If None or empty, uses default.</span>

<span class="sd">  Returns:</span>
<span class="sd">    dict: The dictionary of field keys/values for the specified tab, or an empty dict if the tab is missing or malformed.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : {&quot;tab_contents&quot;: {&quot;Feedback Form&quot;: {&quot;field1&quot;: &quot;value1&quot;}}}, tab_name=&quot;Feedback Form&quot;</span>
<span class="sd">    Output: {&quot;field1&quot;: &quot;value1&quot;}</span>
<span class="sd">    Input : {&quot;tab_contents&quot;: {}}, tab_name=&quot;Feedback Form&quot;</span>
<span class="sd">    Output: {}</span>
<span class="sd">    Input : None, tab_name=&quot;Feedback Form&quot;</span>
<span class="sd">    Output: {}</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If json_data is None, returns empty dict.</span>
<span class="sd">    - If tab_name is None or empty, uses default.</span>
<span class="sd">    - If the tab is missing or malformed, returns empty dict.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tab_contents&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tab_name</span><span class="p">,</span> <span class="p">{})</span>
  <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;extract_tab_payload() failed for tab &#39;</span><span class="si">{</span><span class="n">tab_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.json_deserializer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">json_deserializer</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Custom JSON deserializer for class/type representations created by <code>json_serializer</code>.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>obj</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>)
              –
              <div class="doc-md-description">
                <p>Dictionary object from JSON with special tags for known types. If None, returns None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Any</code></b>(                  <code><span title="typing.Any">Any</span></code>
)              –
              <div class="doc-md-description">
                <p>Reconstructed Python object (datetime, decimal, or class/type), or original dict if no tags found.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="TypeError">TypeError</span></code>
              –
              <div class="doc-md-description">
                <p>If the type tag is unknown or unsupported.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : {"<strong>type</strong>": "datetime.datetime", "value": "2025-07-04T12:34:56.789012"}
Output: datetime.datetime(2025, 7, 4, 12, 34, 56, 789012)
Input : {"<strong>class</strong>": "int", "<strong>module</strong>": "builtins"}
Output: int</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If obj is None, returns None.</li>
<li>If no recognized tags, returns obj unchanged.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">json_deserializer</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Custom JSON deserializer for class/type representations created by `json_serializer`.</span>

<span class="sd">  Args:</span>
<span class="sd">    obj (dict[str, Any]): Dictionary object from JSON with special tags for known types. If None, returns None.</span>

<span class="sd">  Returns:</span>
<span class="sd">    Any: Reconstructed Python object (datetime, decimal, or class/type), or original dict if no tags found.</span>

<span class="sd">  Raises:</span>
<span class="sd">    TypeError: If the type tag is unknown or unsupported.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : {&quot;__type__&quot;: &quot;datetime.datetime&quot;, &quot;value&quot;: &quot;2025-07-04T12:34:56.789012&quot;}</span>
<span class="sd">    Output: datetime.datetime(2025, 7, 4, 12, 34, 56, 789012)</span>
<span class="sd">    Input : {&quot;__class__&quot;: &quot;int&quot;, &quot;__module__&quot;: &quot;builtins&quot;}</span>
<span class="sd">    Output: int</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If obj is None, returns None.</span>
<span class="sd">    - If no recognized tags, returns obj unchanged.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">new_obj</span> <span class="o">=</span> <span class="n">obj</span>

  <span class="k">if</span> <span class="s2">&quot;__class__&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
    <span class="c1"># logger.debug(f&quot;{obj[&#39;__class__&#39;]=} detected in object deserializer.&quot;)</span>
    <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;__class__&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;str&quot;</span><span class="p">:</span>
      <span class="n">new_obj</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;__class__&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;int&quot;</span><span class="p">:</span>
      <span class="n">new_obj</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;__class__&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">:</span>
      <span class="n">new_obj</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;__class__&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
      <span class="n">new_obj</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;__class__&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;datetime&quot;</span><span class="p">:</span>
      <span class="n">new_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> is not JSON deserializable&quot;</span><span class="p">)</span>

  <span class="k">elif</span> <span class="s2">&quot;__type__&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
    <span class="n">type_tag</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;__type__&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">type_tag</span> <span class="o">==</span> <span class="s2">&quot;datetime.datetime&quot;</span><span class="p">:</span>
      <span class="n">new_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">type_tag</span> <span class="o">==</span> <span class="s2">&quot;decimal.Decimal&quot;</span><span class="p">:</span>
      <span class="n">new_obj</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No known conversion type for type </span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;__type__&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="c1"># logger.debug(f&quot;deserializer() returning type= {type(new_obj)}, new_obj= {new_obj}&quot;)</span>

  <span class="k">return</span> <span class="n">new_obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.json_load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">json_load</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">json_options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load and deserialize data from a JSON file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_path</code></b>
                  (<code><span title="str">str</span> | <span title="Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Path to the JSON file. If None or empty, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>json_options</code></b>
                  (<code><span title="dict">dict</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional options passed to <code>json.load</code>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>object</code></b>(                  <code><span title="object">object</span></code>
)              –
              <div class="doc-md-description">
                <p>Deserialized Python object (dict, list, etc.).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If file_path is None or empty.</p>
              </div>
            </li>
            <li>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
              –
              <div class="doc-md-description">
                <p>If the file does not exist.</p>
              </div>
            </li>
            <li>
                  <code><span title="json.JSONDecodeError">JSONDecodeError</span></code>
              –
              <div class="doc-md-description">
                <p>If the file is not valid JSON.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : "data.json"
Output: Deserialized Python object from JSON</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Uses utf-8-sig encoding to handle BOM if present.</li>
<li>If the file is not valid JSON, an exception is raised.</li>
<li>If file_path is None or empty, raises ValueError.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">json_load</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">json_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Load and deserialize data from a JSON file.</span>

<span class="sd">  Args:</span>
<span class="sd">    file_path (str | Path): Path to the JSON file. If None or empty, raises ValueError.</span>
<span class="sd">    json_options (dict | None): Optional options passed to `json.load`.</span>

<span class="sd">  Returns:</span>
<span class="sd">    object: Deserialized Python object (dict, list, etc.).</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If file_path is None or empty.</span>
<span class="sd">    FileNotFoundError: If the file does not exist.</span>
<span class="sd">    json.JSONDecodeError: If the file is not valid JSON.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : &quot;data.json&quot;</span>
<span class="sd">    Output: Deserialized Python object from JSON</span>

<span class="sd">  Notes:</span>
<span class="sd">    - Uses utf-8-sig encoding to handle BOM if present.</span>
<span class="sd">    - If the file is not valid JSON, an exception is raised.</span>
<span class="sd">    - If file_path is None or empty, raises ValueError.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;json_load() called with </span><span class="si">{</span><span class="n">file_path</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">json_options</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="n">file_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">json_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">json_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;object_hook&quot;</span><span class="p">:</span> <span class="n">json_deserializer</span><span class="p">}</span>

  <span class="k">return</span> <span class="n">read_json_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">,</span> <span class="n">json_options</span><span class="o">=</span><span class="n">json_options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.json_load_with_meta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">json_load_with_meta</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">json_options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Load a JSON file and return both data and metadata if present.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_path</code></b>
                  (<code><span title="str">str</span> | <span title="Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Path to the JSON file. If None or empty, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>json_options</code></b>
                  (<code><span title="dict">dict</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional options passed to <code>json.load</code>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>tuple</code></b>(                  <code><span title="tuple">tuple</span>[<span title="typing.Any">Any</span>, <span title="dict">dict</span>]</code>
)              –
              <div class="doc-md-description">
                <ul>
<li>Any: Deserialized data from "<em>data</em>" (or the entire file if "<em>data</em>" is not present).</li>
<li>dict: Deserialized metadata from "<em>metadata</em>" (or empty dict if not present).</li>
</ul>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If file_path is None or empty.</p>
              </div>
            </li>
            <li>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
              –
              <div class="doc-md-description">
                <p>If the file does not exist.</p>
              </div>
            </li>
            <li>
                  <code><span title="json.JSONDecodeError">JSONDecodeError</span></code>
              –
              <div class="doc-md-description">
                <p>If the file is not valid JSON.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : "example.json"
Output: tuple (data, metadata) extracted from the file</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If the JSON file is a dictionary with a key <em>data</em>, then the <em>data</em> and <em>metadata</em> (if possible) will be extracted. Otherwise, the data is assumed to be the entire file contents and metadata is an empty dict.</li>
<li>If file_path is None or empty, raises ValueError.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">json_load_with_meta</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
                        <span class="n">json_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Load a JSON file and return both data and metadata if present.</span>

<span class="sd">  Args:</span>
<span class="sd">    file_path (str | Path): Path to the JSON file. If None or empty, raises ValueError.</span>
<span class="sd">    json_options (dict | None): Optional options passed to `json.load`.</span>

<span class="sd">  Returns:</span>
<span class="sd">    tuple:</span>
<span class="sd">      - Any: Deserialized data from &quot;_data_&quot; (or the entire file if &quot;_data_&quot; is not present).</span>
<span class="sd">      - dict: Deserialized metadata from &quot;_metadata_&quot; (or empty dict if not present).</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If file_path is None or empty.</span>
<span class="sd">    FileNotFoundError: If the file does not exist.</span>
<span class="sd">    json.JSONDecodeError: If the file is not valid JSON.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : &quot;example.json&quot;</span>
<span class="sd">    Output: tuple (data, metadata) extracted from the file</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If the JSON file is a dictionary with a key _data_, then the _data_ and _metadata_ (if possible) will be extracted. Otherwise, the data is assumed to be the entire file contents and metadata is an empty dict.</span>
<span class="sd">    - If file_path is None or empty, raises ValueError.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;json_load_with_meta() called with </span><span class="si">{</span><span class="n">file_path</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">json_options</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="n">file_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

  <span class="n">all_data</span> <span class="o">=</span> <span class="n">json_load</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">json_options</span><span class="o">=</span><span class="n">json_options</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;_data_&quot;</span> <span class="ow">in</span> <span class="n">all_data</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;_data_&quot;</span><span class="p">],</span> <span class="n">all_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_metadata_&quot;</span><span class="p">,</span> <span class="p">{})</span>

  <span class="k">return</span> <span class="n">all_data</span><span class="p">,</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.json_save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">json_save</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">json_options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Save a Python object to a JSON file with optional serialization settings.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_path</code></b>
                  (<code><span title="str">str</span> | <span title="Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Path to write the JSON file. If None or empty, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>data</code></b>
                  (<code><span title="object">object</span></code>)
              –
              <div class="doc-md-description">
                <p>Data to serialize and write. If None, writes 'null' to the file.</p>
              </div>
            </li>
            <li>
              <b><code>json_options</code></b>
                  (<code><span title="dict">dict</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Options to pass to <code>json.dump</code> (e.g., indent, default).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>None</code>
              –
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If file_path is None or empty.</p>
              </div>
            </li>
            <li>
                  <code><span title="OSError">OSError</span></code>
              –
              <div class="doc-md-description">
                <p>If the file cannot be written.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : "output.json", {"x": decimal.Decimal("1.23")}
Output: Creates a JSON file with serialized data at the given path</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If file_path is None or empty, raises ValueError.</li>
<li>If data is None, writes 'null' to the file.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">json_save</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
    <span class="n">json_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Save a Python object to a JSON file with optional serialization settings.</span>

<span class="sd">  Args:</span>
<span class="sd">    file_path (str | Path): Path to write the JSON file. If None or empty, raises ValueError.</span>
<span class="sd">    data (object): Data to serialize and write. If None, writes &#39;null&#39; to the file.</span>
<span class="sd">    json_options (dict | None): Options to pass to `json.dump` (e.g., indent, default).</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If file_path is None or empty.</span>
<span class="sd">    OSError: If the file cannot be written.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : &quot;output.json&quot;, {&quot;x&quot;: decimal.Decimal(&quot;1.23&quot;)}</span>
<span class="sd">    Output: Creates a JSON file with serialized data at the given path</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If file_path is None or empty, raises ValueError.</span>
<span class="sd">    - If data is None, writes &#39;null&#39; to the file.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;json_save() called with </span><span class="si">{</span><span class="n">file_path</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">json_options</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">data</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;file_path must not be None or empty.&quot;</span><span class="p">)</span>
  <span class="n">file_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">json_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">json_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">json_serializer</span><span class="p">,</span> <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>

  <span class="n">save_json_safely</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">json_options</span><span class="o">=</span><span class="n">json_options</span><span class="p">)</span>

  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSON saved to file: &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.json_save_with_meta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">json_save_with_meta</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Save data with metadata to a JSON file under special keys (<em>data</em>, <em>metadata</em>).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_path</code></b>
                  (<code><span title="str">str</span> | <span title="Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>Output JSON file path. If None or empty, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>data</code></b>
                  (<code><span title="object">object</span></code>)
              –
              <div class="doc-md-description">
                <p>Primary data to store under "<em>data</em>". If None, writes 'null' under "<em>data</em>".</p>
              </div>
            </li>
            <li>
              <b><code>metadata</code></b>
                  (<code><span title="dict">dict</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional metadata under "<em>metadata</em>". If None, auto-generated.</p>
              </div>
            </li>
            <li>
              <b><code>json_options</code></b>
                  (<code><span title="dict">dict</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Options for <code>json.dump</code>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>None</code>
              –
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If file_path is None or empty.</p>
              </div>
            </li>
            <li>
                  <code><span title="OSError">OSError</span></code>
              –
              <div class="doc-md-description">
                <p>If the file cannot be written.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : "log.json", {"key": "value"}, metadata={"source": "generated"}
Output: Writes JSON with <em>data</em> and <em>metadata</em> fields</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If metadata is None, a default metadata dict is generated.</li>
<li>If file_path is None or empty, raises ValueError.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">json_save_with_meta</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">json_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Save data with metadata to a JSON file under special keys (_data_, _metadata_).</span>

<span class="sd">  Args:</span>
<span class="sd">    file_path (str | Path): Output JSON file path. If None or empty, raises ValueError.</span>
<span class="sd">    data (object): Primary data to store under &quot;_data_&quot;. If None, writes &#39;null&#39; under &quot;_data_&quot;.</span>
<span class="sd">    metadata (dict | None): Optional metadata under &quot;_metadata_&quot;. If None, auto-generated.</span>
<span class="sd">    json_options (dict | None): Options for `json.dump`.</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If file_path is None or empty.</span>
<span class="sd">    OSError: If the file cannot be written.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : &quot;log.json&quot;, {&quot;key&quot;: &quot;value&quot;}, metadata={&quot;source&quot;: &quot;generated&quot;}</span>
<span class="sd">    Output: Writes JSON with _data_ and _metadata_ fields</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If metadata is None, a default metadata dict is generated.</span>
<span class="sd">    - If file_path is None or empty, raises ValueError.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;json_save_with_meta() called with </span><span class="si">{</span><span class="n">file_path</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">json_options</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">metadata</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">data</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;file_path must not be None or empty.&quot;</span><span class="p">)</span>
  <span class="n">file_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s2">&quot;File created at&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">ZoneInfo</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
    <span class="s2">&quot;Serialized with&quot;</span><span class="p">:</span> <span class="s2">&quot;utils.json.json_save_with_meta&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Deserialize with&quot;</span><span class="p">:</span> <span class="s2">&quot;utils.json.json_load_with_meta&quot;</span><span class="p">,</span>
  <span class="p">})</span>

  <span class="n">wrapped</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;_metadata_&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="s2">&quot;_data_&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="n">json_save</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">wrapped</span><span class="p">,</span> <span class="n">json_options</span><span class="o">=</span><span class="n">json_options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.json_serializer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">json_serializer</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Custom JSON serializer for objects not natively serializable by <code>json.dump</code>.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>obj</code></b>
                  (<code><span title="object">object</span></code>)
              –
              <div class="doc-md-description">
                <p>The object to serialize. Supported: datetime, decimal, class/type objects. If None, raises TypeError.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>A JSON-compatible dictionary representation of the object.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="TypeError">TypeError</span></code>
              –
              <div class="doc-md-description">
                <p>If the object type is unsupported or if obj is None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : datetime.datetime.now()
Output: {"<strong>type</strong>": "datetime.datetime", "value": "2025-07-04T12:34:56.789012"}
Input : decimal.Decimal("1.23")
Output: {"<strong>type</strong>": "decimal.Decimal", "value": "1.23"}</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Only supports specific types; all others raise TypeError.</li>
<li>If obj is None, raises TypeError.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">json_serializer</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Custom JSON serializer for objects not natively serializable by `json.dump`.</span>

<span class="sd">  Args:</span>
<span class="sd">    obj (object): The object to serialize. Supported: datetime, decimal, class/type objects. If None, raises TypeError.</span>

<span class="sd">  Returns:</span>
<span class="sd">    dict: A JSON-compatible dictionary representation of the object.</span>

<span class="sd">  Raises:</span>
<span class="sd">    TypeError: If the object type is unsupported or if obj is None.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : datetime.datetime.now()</span>
<span class="sd">    Output: {&quot;__type__&quot;: &quot;datetime.datetime&quot;, &quot;value&quot;: &quot;2025-07-04T12:34:56.789012&quot;}</span>
<span class="sd">    Input : decimal.Decimal(&quot;1.23&quot;)</span>
<span class="sd">    Output: {&quot;__type__&quot;: &quot;decimal.Decimal&quot;, &quot;value&quot;: &quot;1.23&quot;}</span>

<span class="sd">  Notes:</span>
<span class="sd">    - Only supports specific types; all others raise TypeError.</span>
<span class="sd">    - If obj is None, raises TypeError.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;__class__&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__module__</span><span class="p">}</span>
  <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;__type__&quot;</span><span class="p">:</span> <span class="s2">&quot;datetime.datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()}</span>
  <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;__type__&quot;</span><span class="p">:</span> <span class="s2">&quot;decimal.Decimal&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)}</span>

  <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> is not JSON serializable&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.make_dict_serializeable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_dict_serializeable</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">type_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">convert_time_to_ca</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Transform a dictionary to ensure JSON compatibility of its values.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>input_dict</code></b>
                  (<code><span title="dict">dict</span></code>)
              –
              <div class="doc-md-description">
                <p>Original dictionary to process. If None, raises ValueError.</p>
              </div>
            </li>
            <li>
              <b><code>type_map</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="type">type</span>] | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional field-to-type map for casting. If not provided, no casting is performed.</p>
              </div>
            </li>
            <li>
              <b><code>convert_time_to_ca</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Convert datetimes to CA time before serialization.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>Dictionary with all values JSON-serializable.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If input_dict is None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : {"amount": decimal.Decimal("1.23"), "date": datetime.datetime(2025, 7, 4, 12, 0)}
Output: {"amount": "1.23", "date": "2025-07-04T12:00:00"}</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If input_dict is None, raises ValueError.</li>
<li>If type_map is provided, values are cast to the specified types before serialization.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_dict_serializeable</span><span class="p">(</span>
    <span class="n">input_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">type_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">convert_time_to_ca</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Transform a dictionary to ensure JSON compatibility of its values.</span>

<span class="sd">  Args:</span>
<span class="sd">    input_dict (dict): Original dictionary to process. If None, raises ValueError.</span>
<span class="sd">    type_map (dict[str, type] | None): Optional field-to-type map for casting. If not provided, no casting is performed.</span>
<span class="sd">    convert_time_to_ca (bool): Convert datetimes to CA time before serialization.</span>

<span class="sd">  Returns:</span>
<span class="sd">    dict: Dictionary with all values JSON-serializable.</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If input_dict is None.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : {&quot;amount&quot;: decimal.Decimal(&quot;1.23&quot;), &quot;date&quot;: datetime.datetime(2025, 7, 4, 12, 0)}</span>
<span class="sd">    Output: {&quot;amount&quot;: &quot;1.23&quot;, &quot;date&quot;: &quot;2025-07-04T12:00:00&quot;}</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If input_dict is None, raises ValueError.</span>
<span class="sd">    - If type_map is provided, values are cast to the specified types before serialization.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All keys must be strings. Invalid key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">type_map</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">type_map</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">safe_cast</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">type_map</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to cast key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; to </span><span class="si">{</span><span class="n">type_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># todo - datetime - change this to ensure datetime is iso and fail if it is not</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">convert_time_to_ca</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">ca_naive_datetime_to_utc_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
      <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

  <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.normalize_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Normalize a value for string-based diffing or comparison.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>val</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>Value to normalize (any type). If None or empty string, returns "". If datetime, returns ISO string.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>str</code></b>(                  <code><span title="str">str</span></code>
)              –
              <div class="doc-md-description">
                <p>Normalized string value. None and empty string become "". Datetimes are ISO strings.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : None
Output: ""
Input : ""
Output: ""
Input : datetime.datetime(2025, 1, 1, 12, 0)
Output: "2025-01-01T12:00:00"
Input : 123
Output: "123"</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>None and empty strings ("") are treated identically, returning "".</li>
<li>Naive datetime values are assumed to be in California time and converted to UTC.</li>
<li>All other types are stringified using str(val).</li>
<li>Ensures fields that were previously None but now filled with an empty string (or vice versa) are not falsely flagged as changed. Datetime normalization is contract-compliant.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_value</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Normalize a value for string-based diffing or comparison.</span>

<span class="sd">  Args:</span>
<span class="sd">    val: Value to normalize (any type). If None or empty string, returns &quot;&quot;. If datetime, returns ISO string.</span>

<span class="sd">  Returns:</span>
<span class="sd">    str: Normalized string value. None and empty string become &quot;&quot;. Datetimes are ISO strings.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : None</span>
<span class="sd">    Output: &quot;&quot;</span>
<span class="sd">    Input : &quot;&quot;</span>
<span class="sd">    Output: &quot;&quot;</span>
<span class="sd">    Input : datetime.datetime(2025, 1, 1, 12, 0)</span>
<span class="sd">    Output: &quot;2025-01-01T12:00:00&quot;</span>
<span class="sd">    Input : 123</span>
<span class="sd">    Output: &quot;123&quot;</span>

<span class="sd">  Notes:</span>
<span class="sd">    - None and empty strings (&quot;&quot;) are treated identically, returning &quot;&quot;.</span>
<span class="sd">    - Naive datetime values are assumed to be in California time and converted to UTC.</span>
<span class="sd">    - All other types are stringified using str(val).</span>
<span class="sd">    - Ensures fields that were previously None but now filled with an empty string (or vice versa) are not falsely flagged as changed. Datetime normalization is contract-compliant.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
  <span class="kn">from</span><span class="w"> </span><span class="nn">arb.utils.date_and_time</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_datetime_naive</span><span class="p">,</span> <span class="n">ca_naive_datetime_to_utc_datetime</span>
  <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_datetime_naive</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
      <span class="n">val</span> <span class="o">=</span> <span class="n">ca_naive_datetime_to_utc_datetime</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
  <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.safe_json_loads" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">safe_json_loads</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">context_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Safely parse a JSON string into a Python dictionary.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>value</code></b>
                  (<code><span title="str">str</span> | <span title="dict">dict</span> | None</code>)
              –
              <div class="doc-md-description">
                <p>JSON-formatted string, pre-decoded dict, or None. If not str, dict, or None, raises TypeError.</p>
              </div>
            </li>
            <li>
              <b><code>context_label</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Optional label for diagnostics/logging.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>Parsed dictionary from the input, or empty dict if input is None, invalid, or already a valid dict.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="TypeError">TypeError</span></code>
              –
              <div class="doc-md-description">
                <p>If <code>value</code> is not a str, dict, or None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : '{"a": 1, "b": 2}'
Output: {"a": 1, "b": 2}
Input : {"a": 1, "b": 2}
Output: {"a": 1, "b": 2}
Input : None
Output: {}
Input : ""
Output: {}
Input : "not valid json"
Output: {}</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If <code>value</code> is already a dict, it is returned unchanged.</li>
<li>If <code>value</code> is None, empty, or invalid JSON, an empty dict is returned.</li>
<li>If decoding fails, a warning is logged including the context_label.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">safe_json_loads</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">context_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Safely parse a JSON string into a Python dictionary.</span>

<span class="sd">  Args:</span>
<span class="sd">    value (str | dict | None): JSON-formatted string, pre-decoded dict, or None. If not str, dict, or None, raises TypeError.</span>
<span class="sd">    context_label (str): Optional label for diagnostics/logging.</span>

<span class="sd">  Returns:</span>
<span class="sd">    dict: Parsed dictionary from the input, or empty dict if input is None, invalid, or already a valid dict.</span>

<span class="sd">  Raises:</span>
<span class="sd">    TypeError: If `value` is not a str, dict, or None.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : &#39;{&quot;a&quot;: 1, &quot;b&quot;: 2}&#39;</span>
<span class="sd">    Output: {&quot;a&quot;: 1, &quot;b&quot;: 2}</span>
<span class="sd">    Input : {&quot;a&quot;: 1, &quot;b&quot;: 2}</span>
<span class="sd">    Output: {&quot;a&quot;: 1, &quot;b&quot;: 2}</span>
<span class="sd">    Input : None</span>
<span class="sd">    Output: {}</span>
<span class="sd">    Input : &quot;&quot;</span>
<span class="sd">    Output: {}</span>
<span class="sd">    Input : &quot;not valid json&quot;</span>
<span class="sd">    Output: {}</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If `value` is already a dict, it is returned unchanged.</span>
<span class="sd">    - If `value` is None, empty, or invalid JSON, an empty dict is returned.</span>
<span class="sd">    - If decoding fails, a warning is logged including the context_label.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{}</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected str, dict, or None; got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
    <span class="n">label_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">context_label</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">context_label</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corrupt or invalid JSON string encountered</span><span class="si">{</span><span class="n">label_msg</span><span class="si">}</span><span class="s2">; returning empty dict.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="arb.utils.json.wtform_types_and_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wtform_types_and_values</span><span class="p">(</span><span class="n">wtform</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extract field types and current data values from a WTForm.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>wtform</code></b>
                  (<code><span title="FlaskForm">FlaskForm</span></code>)
              –
              <div class="doc-md-description">
                <p>WTForms instance. Must not be None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>tuple</code></b>(                  <code><span title="tuple">tuple</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="type">type</span>], <span title="dict">dict</span>[<span title="str">str</span>, <span title="object">object</span>]]</code>
)              –
              <div class="doc-md-description">
                <ul>
<li>dict[str, type]: Field name to type mapping for deserialization.</li>
<li>dict[str, object]: Field name to current value mapping (may include 'Please Select').</li>
</ul>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If wtform is None or does not have _fields attribute.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Input : form (WTForms instance)
Output: (type_map, field_data) where type_map is a dict of field types and field_data is a dict of field values</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If wtform is None or invalid, raises ValueError.</li>
<li>'Please Select' is a valid value for SelectField.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\utils\json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wtform_types_and_values</span><span class="p">(</span>
    <span class="n">wtform</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Extract field types and current data values from a WTForm.</span>

<span class="sd">  Args:</span>
<span class="sd">    wtform (FlaskForm): WTForms instance. Must not be None.</span>

<span class="sd">  Returns:</span>
<span class="sd">    tuple:</span>
<span class="sd">      - dict[str, type]: Field name to type mapping for deserialization.</span>
<span class="sd">      - dict[str, object]: Field name to current value mapping (may include &#39;Please Select&#39;).</span>

<span class="sd">  Raises:</span>
<span class="sd">    ValueError: If wtform is None or does not have _fields attribute.</span>

<span class="sd">  Examples:</span>
<span class="sd">    Input : form (WTForms instance)</span>
<span class="sd">    Output: (type_map, field_data) where type_map is a dict of field types and field_data is a dict of field values</span>

<span class="sd">  Notes:</span>
<span class="sd">    - If wtform is None or invalid, raises ValueError.</span>
<span class="sd">    - &#39;Please Select&#39; is a valid value for SelectField.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">wtform</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wtform</span><span class="p">,</span> <span class="s1">&#39;_fields&#39;</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wtform must have a _fields attribute&quot;</span><span class="p">)</span>
  <span class="n">type_map</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">field_data</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">wtform</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span>
    <span class="n">field_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">DateTimeField</span><span class="p">):</span>
      <span class="n">type_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">DecimalField</span><span class="p">):</span>
      <span class="n">type_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">BooleanField</span><span class="p">):</span>
      <span class="n">type_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">IntegerField</span><span class="p">):</span>
      <span class="n">type_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">SelectField</span><span class="p">):</span>
      <span class="n">type_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span>  <span class="c1"># &#39;Please Select&#39; is valid</span>

  <span class="k">return</span> <span class="n">type_map</span><span class="p">,</span> <span class="n">field_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../io_wrappers/" class="btn btn-neutral float-left" title="arb.utils.io_wrappers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../log_util/" class="btn btn-neutral float-right" title="arb.utils.log_util">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../io_wrappers/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../log_util/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../../..";</script>
    <script src="../../../../js/theme_extra.js"></script>
    <script src="../../../../js/theme.js"></script>
      <script src="../../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
