<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://tony-held-carb.github.io/reference/arb/portal/wtf_landfill/" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>arb.portal.wtf_landfill - CalSMP Operator Feedback Portal</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "arb.portal.wtf_landfill";
        var mkdocs_page_input_path = "reference\\arb\\portal\\wtf_landfill.md";
        var mkdocs_page_url = "/reference/arb/portal/wtf_landfill/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> CalSMP Operator Feedback Portal
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../..">Welcome &amp; Instructions</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Arb</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../__get_logger/">arb.__get_logger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../wsgi/">arb.wsgi</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >Portal</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../app/">arb.portal.app</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../constants/">arb.portal.constants</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../db_hardcoded/">arb.portal.db_hardcoded</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../extensions/">arb.portal.extensions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../globals/">arb.portal.globals</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../json_update_util/">arb.portal.json_update_util</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../routes/">arb.portal.routes</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../sqla_models/">arb.portal.sqla_models</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">arb.portal.wtf_landfill</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#arb.portal.wtf_landfill">wtf_landfill</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#arb.portal.wtf_landfill.LandfillFeedback">LandfillFeedback</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../wtf_oil_and_gas/">arb.portal.wtf_oil_and_gas</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../wtf_upload/">arb.portal.wtf_upload</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Config</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../config/accessors/">arb.portal.config.accessors</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../config/settings/">arb.portal.config.settings</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Forms</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../forms/sector_form_loader/">arb.portal.forms.sector_form_loader</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Startup</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../startup/db/">arb.portal.startup.db</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../startup/flask/">arb.portal.startup.flask</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../startup/runtime_info/">arb.portal.startup.runtime_info</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Utils</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../utils/db_ingest_util/">arb.portal.utils.db_ingest_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../utils/db_introspection_util/">arb.portal.utils.db_introspection_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../utils/file_upload_util/">arb.portal.utils.file_upload_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../utils/form_mapper/">arb.portal.utils.form_mapper</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../utils/route_util/">arb.portal.utils.route_util</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../utils/sector_util/">arb.portal.utils.sector_util</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Utils</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/constants/">arb.utils.constants</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/database/">arb.utils.database</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/date_and_time/">arb.utils.date_and_time</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/diagnostics/">arb.utils.diagnostics</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/file_io/">arb.utils.file_io</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/io_wrappers/">arb.utils.io_wrappers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/json/">arb.utils.json</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/log_util/">arb.utils.log_util</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/misc/">arb.utils.misc</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/sql_alchemy/">arb.utils.sql_alchemy</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/web_html/">arb.utils.web_html</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/wtf_forms_util/">arb.utils.wtf_forms_util</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Excel</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../utils/excel/xl_create/">arb.utils.excel.xl_create</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../utils/excel/xl_file_structure/">arb.utils.excel.xl_file_structure</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../utils/excel/xl_hardcoded/">arb.utils.excel.xl_hardcoded</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../utils/excel/xl_misc/">arb.utils.excel.xl_misc</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../utils/excel/xl_parse/">arb.utils.excel.xl_parse</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">CalSMP Operator Feedback Portal</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Reference</li>
          <li class="breadcrumb-item">Arb</li>
          <li class="breadcrumb-item">Portal</li>
      <li class="breadcrumb-item active">arb.portal.wtf_landfill</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="arbportalwtf_landfill"><code>arb.portal.wtf_landfill</code></h1>


<div class="doc doc-object doc-module">



<a id="arb.portal.wtf_landfill"></a>
    <div class="doc doc-contents first">

        <p>Landfill feedback form definition for the ARB Feedback Portal (WTForms).</p>
<p>This module defines the <code>LandfillFeedback</code> class, a comprehensive WTForms-based
HTML form for collecting information on methane emission inspections and responses
at landfill sites. The form is organized into multiple logical sections and includes
dynamic dropdown behavior, conditional validation, and cross-field logic.</p>
<h3 id="arb.portal.wtf_landfill--key-features">Key Features:</h3>
<ul>
<li>Uses <code>FlaskForm</code> as a base and is rendered using Bootstrap-compatible templates.</li>
<li>Dropdowns support conditional dependencies using <code>Globals.drop_downs_contingent</code>.</li>
<li>Validators are programmatically adjusted to enforce or relax constraints based on user input.</li>
<li>Supports optional "Other" fields that are only required when triggered.</li>
<li>Final validation is managed via a custom <code>validate()</code> override.</li>
</ul>
<h3 id="arb.portal.wtf_landfill--example-usage">Example Usage:</h3>
<p>form = LandfillFeedback()
  form.process(request.form)</p>
<p>if form.validate_on_submit():
    # Process and store form data
    save_landfill_feedback(form.data)</p>
<h3 id="arb.portal.wtf_landfill--notes">Notes:</h3>
<ul>
<li>The <code>update_contingent_selectors()</code> method updates selector/contingent choices.</li>
<li>The <code>determine_contingent_fields()</code> method enforces dynamic field-level validation.</li>
<li>Intended for use with the <code>landfill_incidence_update</code> route and similar flows.</li>
<li>General-purpose WTForms utilities are located in:
    arb.utils.wtf_forms_util.py</li>
</ul>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="arb.portal.wtf_landfill.LandfillFeedback" class="doc doc-heading">
            <code>LandfillFeedback</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flask_wtf.FlaskForm">FlaskForm</span></code></p>


        <p>WTForms form class for collecting landfill feedback data.</p>
<p>Captures user-submitted information about methane emissions,
inspections, corrective actions, and contact details related to
landfill facility operations.</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Some fields are conditionally validated depending on selections.</li>
<li>The form dynamically updates contingent dropdowns using
  <code>update_contingent_selectors()</code>.</li>
<li>Final validation is enforced in the <code>validate()</code> method.</li>
</ul>
</details>






              <details class="quote">
                <summary>Source code in <code>arb\portal\wtf_landfill.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LandfillFeedback</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  WTForms form class for collecting landfill feedback data.</span>

<span class="sd">  Captures user-submitted information about methane emissions,</span>
<span class="sd">  inspections, corrective actions, and contact details related to</span>
<span class="sd">  landfill facility operations.</span>

<span class="sd">  Notes:</span>
<span class="sd">    - Some fields are conditionally validated depending on selections.</span>
<span class="sd">    - The form dynamically updates contingent dropdowns using</span>
<span class="sd">      `update_contingent_selectors()`.</span>
<span class="sd">    - Final validation is enforced in the `validate()` method.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># Section 2</span>
  <span class="c1"># todo - likely have to change these to InputRequired(), Optional(), blank and removed</span>
  <span class="c1"># label = &quot;1.  Incidence/Emission ID&quot;</span>
  <span class="n">id_incidence</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span>
    <span class="s2">&quot;Incidence/Emission ID&quot;</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">()],</span>
    <span class="n">render_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;readonly&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;2.  Plume ID(s)&quot;</span>
  <span class="n">id_plume</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="n">NumberRange</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Plume ID must be a positive integer&quot;</span><span class="p">)],</span>
  <span class="p">)</span>  <span class="c1"># REFERENCES plumes (id_plume)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;3.  Plume Observation Date&quot;</span>
  <span class="n">observation_timestamp</span> <span class="o">=</span> <span class="n">DateTimeLocalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">HTML_LOCAL_TIME_FORMAT</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;4.  Plume Origin CARB Estimated Latitude&quot;</span>
  <span class="c1"># I think lat/longs are failing because they were renamed ...</span>

  <span class="n">lat_carb</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">places</span><span class="o">=</span><span class="n">GPS_RESOLUTION</span><span class="p">,</span>
    <span class="c1"># validators=[Optional(), NumberRange(**LATITUDE_VALIDATION), min_decimal_precision(GPS_RESOLUTION)],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">(),</span> <span class="n">NumberRange</span><span class="p">(</span><span class="o">**</span><span class="n">LATITUDE_VALIDATION</span><span class="p">)],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;5.  Plume Origin CARB Estimated Longitude&quot;</span>
  <span class="n">long_carb</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">places</span><span class="o">=</span><span class="n">GPS_RESOLUTION</span><span class="p">,</span>
    <span class="c1"># validators=[Optional(), NumberRange(**LONGITUDE_VALIDATION), min_decimal_precision(GPS_RESOLUTION)],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">(),</span> <span class="n">NumberRange</span><span class="p">(</span><span class="o">**</span><span class="n">LONGITUDE_VALIDATION</span><span class="p">)],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;6.  CARB Message ID&quot;</span>
  <span class="n">id_message</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="c1"># Section 3</span>
  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q1.  Facility Name&quot;</span>
  <span class="n">facility_name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q2.  Facility SWIS ID&quot;</span>
  <span class="n">id_arb_swis</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q3.  Contact Name&quot;</span>
  <span class="n">contact_name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
  <span class="p">)</span>
  <span class="c1"># contact_phone = StringField(label=&quot;Contact Phone&quot;, validators=[InputRequired()])</span>
  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q4.  Contact Phone&quot;</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Invalid phone number. Phone number must be in format &#39;(123) 456-7890&#39; or &#39;(123) 456-7890 x1234567&#39;.&quot;</span>
  <span class="n">contact_phone</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span>
                <span class="n">Regexp</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^\(\d</span><span class="si">{3}</span><span class="s2">\) \d</span><span class="si">{3}</span><span class="s2">-\d</span><span class="si">{4}</span><span class="s2">( x\d{1,7})?$&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
                <span class="p">],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q5.  Contact Email&quot;</span>
  <span class="n">contact_email</span> <span class="o">=</span> <span class="n">EmailField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="n">Email</span><span class="p">()])</span>

  <span class="c1"># Section 4</span>
  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q6.  Date of owner/operatorâ€™s follow-up ground monitoring.&quot;</span>
  <span class="n">inspection_timestamp</span> <span class="o">=</span> <span class="n">DateTimeLocalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="p">],</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">HTML_LOCAL_TIME_FORMAT</span><span class="p">,</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q7.  Instrument used to locate the leak (e.g., Fisher Scientific TVA2020; RKI Multigas Analyzer Eagle 2; TDL).&quot;</span>
  <span class="n">instrument</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()])</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q8.  Was a leak identified through prior knowledge or by follow-up monitoring after receipt of a CARB plume notice?&quot;</span>
  <span class="n">emission_identified_flag_fk</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs</span><span class="p">[</span><span class="s2">&quot;emission_identified_flag_fk&quot;</span><span class="p">],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="p">],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q9.  If no leaks were found, please describe any events or activities that may have &quot;</span>
           <span class="sa">f</span><span class="s2">&quot;contributed to the plume observed on the date provided in Section 2.&quot;</span><span class="p">)</span>
  <span class="n">additional_activities</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="c1"># Section 5</span>
  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q10:  Maximum concentration of methane leak (in ppmv).&quot;</span>
  <span class="n">initial_leak_concentration</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q11.  Please provide a revised latitude if the leak location differs from CARB&#39;s estimate in Section 2.&quot;</span>
  <span class="n">lat_revised</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">places</span><span class="o">=</span><span class="n">GPS_RESOLUTION</span><span class="p">,</span>
    <span class="c1"># validators=[Optional(), NumberRange(**LATITUDE_VALIDATION), min_decimal_precision(GPS_RESOLUTION)],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">(),</span> <span class="n">NumberRange</span><span class="p">(</span><span class="o">**</span><span class="n">LATITUDE_VALIDATION</span><span class="p">)],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q12.  Please provide a revised longitude if the leak location differs from CARB&#39;s estimate in Section 2.&quot;</span>
  <span class="n">long_revised</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">places</span><span class="o">=</span><span class="n">GPS_RESOLUTION</span><span class="p">,</span>
    <span class="c1"># validators=[Optional(), NumberRange(**LONGITUDE_VALIDATION), min_decimal_precision(GPS_RESOLUTION)],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">(),</span> <span class="n">NumberRange</span><span class="p">(</span><span class="o">**</span><span class="n">LONGITUDE_VALIDATION</span><span class="p">)],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q13:  Please select from the drop-down menu which option best matches the description of the leak.&quot;</span>
  <span class="n">emission_type_fk</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs</span><span class="p">[</span><span class="s2">&quot;emission_type_fk&quot;</span><span class="p">],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="p">],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q14.  Please select from the drop-down menu which option best describes the location of the leak.&quot;</span>
  <span class="n">emission_location</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs</span><span class="p">[</span><span class="s2">&quot;emission_location&quot;</span><span class="p">],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="p">],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q15.  Please provide a more detailed description of the leak location, &quot;</span>
           <span class="sa">f</span><span class="s2">&quot;including grid ID number or component name, if applicable.&quot;</span><span class="p">)</span>
  <span class="n">emission_location_notes</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q16.  Please select the most likely cause of the leak.&quot;</span>
  <span class="n">emission_cause</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs</span><span class="p">[</span><span class="s2">&quot;emission_cause&quot;</span><span class="p">],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="p">],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q17 (Optional).  Please select an alternative cause (only if suspected).  &quot;</span>
           <span class="sa">f</span><span class="s2">&quot;This should not be the same as your Q16 response.&quot;</span><span class="p">)</span>
  <span class="n">emission_cause_secondary</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs</span><span class="p">[</span><span class="s2">&quot;emission_cause_secondary&quot;</span><span class="p">],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q18 (Optional).  Please select an alternative cause (only if suspected).  &quot;</span>
           <span class="sa">f</span><span class="s2">&quot;This should not be the same as your Q16 or Q17 responses.&quot;</span><span class="p">)</span>
  <span class="n">emission_cause_tertiary</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs</span><span class="p">[</span><span class="s2">&quot;emission_cause_tertiary&quot;</span><span class="p">],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q19.  Please provide a more detailed description of the cause(s), &quot;</span>
           <span class="sa">f</span><span class="s2">&quot;including the reason for and duration of any construction activity or downtime.&quot;</span><span class="p">)</span>
  <span class="n">emission_cause_notes</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q20.  Describe any corrective actions taken.&quot;</span>
  <span class="n">mitigation_actions</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q21.  Repair date.&quot;</span>
  <span class="n">mitigation_timestamp</span> <span class="o">=</span> <span class="n">DateTimeLocalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">HTML_LOCAL_TIME_FORMAT</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q22.  Re-monitored date.&quot;</span>
  <span class="n">re_monitored_timestamp</span> <span class="o">=</span> <span class="n">DateTimeLocalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Optional</span><span class="p">()],</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">HTML_LOCAL_TIME_FORMAT</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q23.  Re-monitored methane concentration after repair (ppmv).&quot;</span>
  <span class="n">re_monitored_concentration</span> <span class="o">=</span> <span class="n">DecimalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q24.  Was the leak location monitored in the most recent &quot;</span>
           <span class="sa">f</span><span class="s2">&quot;prior quarterly/annual surface emissions or quarterly component leak monitoring event?&quot;</span><span class="p">)</span>
  <span class="n">included_in_last_lmr</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs</span><span class="p">[</span><span class="s2">&quot;included_in_last_lmr&quot;</span><span class="p">],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="p">],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q25.  If &#39;No&#39; to Q24, please explain why the area was excluded from monitoring.&quot;</span>
  <span class="n">included_in_last_lmr_description</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()])</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q26.  Is this grid/component planned for inclusion in the next quarterly/annual leak monitoring?&quot;</span>
  <span class="n">planned_for_next_lmr</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs</span><span class="p">[</span><span class="s2">&quot;planned_for_next_lmr&quot;</span><span class="p">],</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">(),</span> <span class="p">],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q27.  If &#39;No&#39; to Q26, please state why the area will not be monitored.&quot;</span>
  <span class="n">planned_for_next_lmr_description</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()])</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q28.  Date of most recent surface emissions monitoring event (prior to this notification).&quot;</span>
  <span class="n">last_component_leak_monitoring_timestamp</span> <span class="o">=</span> <span class="n">DateTimeLocalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">HTML_LOCAL_TIME_FORMAT</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q29.  Date of most recent component leak monitoring event (prior to this notification).&quot;</span>
  <span class="n">last_surface_monitoring_timestamp</span> <span class="o">=</span> <span class="n">DateTimeLocalField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">InputRequired</span><span class="p">()],</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">HTML_LOCAL_TIME_FORMAT</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Q30. Additional notes or comments.&quot;</span>
  <span class="n">additional_notes</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[],</span>
  <span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;1. CARB internal notes&quot;</span>
  <span class="n">carb_notes</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
    <span class="n">validators</span><span class="o">=</span><span class="p">[],</span>
  <span class="p">)</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">update_contingent_selectors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update contingent dropdown field choices based on current field selections.</span>

<span class="sd">    This method looks up selector/contingent relationships defined in</span>
<span class="sd">    `Globals.drop_downs_contingent` and dynamically modifies the `choices`</span>
<span class="sd">    for child fields when a selector field has a known dependency.</span>

<span class="sd">    This method dynamically updates the primary, secondary, and tertiary</span>
<span class="sd">    emission cause fields based on the value of `self.emission_location`. It</span>
<span class="sd">    ensures valid dropdown options and clears invalid selections.</span>

<span class="sd">    Assumes:</span>
<span class="sd">      - `self.emission_location`, `self.emission_cause`,</span>
<span class="sd">        `self.emission_cause_secondary`, and `self.emission_cause_tertiary`</span>
<span class="sd">        are all `SelectField` instances.</span>
<span class="sd">      - `Globals.drop_downs_contingent` contains a nested dictionary of</span>
<span class="sd">        location-contingent dropdown options.</span>

<span class="sd">    Returns:</span>
<span class="sd">      None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># todo - update contingent dropdowns?</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running update_contingent_selectors()&quot;</span><span class="p">)</span>

    <span class="n">emission_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">data</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected emission_location: </span><span class="si">{</span><span class="n">emission_location</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">emission_cause_dict</span> <span class="o">=</span> <span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs_contingent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
      <span class="s2">&quot;emission_cause_contingent_on_emission_location&quot;</span><span class="p">,</span> <span class="p">{}</span>
    <span class="p">)</span>
    <span class="n">choices_raw</span> <span class="o">=</span> <span class="n">emission_cause_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">emission_location</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available contingent causes: </span><span class="si">{</span><span class="n">choices_raw</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Define headers</span>
    <span class="n">primary_header</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">(</span><span class="n">PLEASE_SELECT</span><span class="p">,</span> <span class="n">PLEASE_SELECT</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;disabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
      <span class="p">(</span><span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span>
       <span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span> <span class="p">{}),</span>
    <span class="p">]</span>
    <span class="n">secondary_tertiary_header</span> <span class="o">=</span> <span class="n">primary_header</span> <span class="o">+</span> <span class="p">[</span>
      <span class="p">(</span><span class="s2">&quot;Not applicable as no additional leak cause suspected&quot;</span><span class="p">,</span>
       <span class="s2">&quot;Not applicable as no additional leak cause suspected&quot;</span><span class="p">,</span> <span class="p">{}),</span>
    <span class="p">]</span>

    <span class="c1"># Build full choices</span>
    <span class="n">primary_choices</span> <span class="o">=</span> <span class="n">build_choices</span><span class="p">(</span><span class="n">primary_header</span><span class="p">,</span> <span class="n">choices_raw</span><span class="p">)</span>
    <span class="n">secondary_tertiary_choices</span> <span class="o">=</span> <span class="n">build_choices</span><span class="p">(</span><span class="n">secondary_tertiary_header</span><span class="p">,</span> <span class="n">choices_raw</span><span class="p">)</span>

    <span class="c1"># Update each field&#39;s choices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">primary_choices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">secondary_tertiary_choices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">secondary_tertiary_choices</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_validators</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override WTForms default validation with custom cross-field logic.</span>

<span class="sd">    Ensures required fields are conditionally enforced based on upstream</span>
<span class="sd">    values, including:</span>
<span class="sd">      - Facility activity selections imply required contingent selections</span>
<span class="sd">      - If &quot;Other&quot; is chosen, corresponding text input must be filled</span>
<span class="sd">      - If leak is confirmed, additional emission details are required</span>

<span class="sd">    Returns:</span>
<span class="sd">      bool: True if form is valid, False otherwise.</span>

<span class="sd">    Notes:</span>
<span class="sd">      - Calls `determine_contingent_fields()` before validation to</span>
<span class="sd">        ensure field validators are correct.</span>
<span class="sd">      - Uses built-in `super().validate()` after adjusting validators.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;validate() called.&quot;</span><span class="p">)</span>
    <span class="n">form_fields</span> <span class="o">=</span> <span class="n">get_wtforms_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Dictionary to replace standard WTForm messages with an alternative message</span>
    <span class="n">error_message_replacement_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Not a valid float value.&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid numeric value.&quot;</span><span class="p">}</span>

    <span class="c1">###################################################################################################</span>
    <span class="c1"># Add, Remove, or Modify validation at a field level here before the super is called (for example)</span>
    <span class="c1">###################################################################################################</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">determine_contingent_fields</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_contingent_selectors</span><span class="p">()</span>

    <span class="c1">###################################################################################################</span>
    <span class="c1"># Set selectors with values not in their choice&#39;s list to &quot;Please Select&quot;</span>
    <span class="c1">###################################################################################################</span>
    <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">form_fields</span><span class="p">:</span>
      <span class="n">field</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;field_name: </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">raw_data</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">SelectField</span><span class="p">):</span>
        <span class="n">ensure_field_choice</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>

    <span class="c1">###################################################################################################</span>
    <span class="c1"># call the super to perform each field&#39;s individual validation (which saves to form.errors)</span>
    <span class="c1"># This will create the form.errors dictionary.  If there are form_errors they will be in the None key.</span>
    <span class="c1"># The form_errors will not affect if validate returns True/False, only the fields are considered.</span>
    <span class="c1">###################################################################################################</span>
    <span class="c1"># logger.debug(f&quot;in the validator before super&quot;)</span>
    <span class="n">obj_diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;in the validator before super&quot;</span><span class="p">)</span>

    <span class="n">_</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">extra_validators</span><span class="o">=</span><span class="n">extra_validators</span><span class="p">)</span>

    <span class="c1">###################################################################################################</span>
    <span class="c1"># Validating selectors explicitly ensures the same number of errors on GETS and POSTS for the same data</span>
    <span class="c1">###################################################################################################</span>
    <span class="n">validate_selectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PLEASE_SELECT</span><span class="p">)</span>

    <span class="c1">###################################################################################################</span>
    <span class="c1"># Perform any field level validation where one field is cross-referenced to another</span>
    <span class="c1"># The error will be associated with one of the fields</span>
    <span class="c1">###################################################################################################</span>
    <span class="c1"># todo - move field level validation to separate function</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_identified_flag_fk</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;No leak was detected&quot;</span><span class="p">:</span>
      <span class="n">valid_options</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLEASE_SELECT</span><span class="p">,</span>
                       <span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;Not applicable as no additional leak cause suspected&quot;</span><span class="p">,</span>
                       <span class="p">]</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q13 appear to be inconsistent&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q14 appear to be inconsistent&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q16 appear to be inconsistent&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q17 appear to be inconsistent&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q18 appear to be inconsistent&quot;</span><span class="p">)</span>

    <span class="c1"># Q8 and Q13 should be coupled to Operator-aware response</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_identified_flag_fk</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;Operator was aware of the leak prior to receiving the CARB plume notification&quot;</span><span class="p">:</span>
      <span class="n">valid_options</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLEASE_SELECT</span><span class="p">,</span>
                       <span class="s2">&quot;Operator was aware of the leak prior to receiving the notification, and/or repairs were in progress on the date of the plume observation&quot;</span><span class="p">,</span> <span class="p">]</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q13 appear to be inconsistent&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_identified_flag_fk</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="s2">&quot;No leak was detected&quot;</span><span class="p">:</span>
      <span class="n">invalid_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span> <span class="p">]</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q13 appear to be inconsistent&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q14 appear to be inconsistent&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q16 appear to be inconsistent&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q17 appear to be inconsistent&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q18 appear to be inconsistent&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspection_timestamp</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mitigation_timestamp</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mitigation_timestamp</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspection_timestamp</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mitigation_timestamp</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
          <span class="s2">&quot;Date of mitigation cannot be prior to initial site inspection.&quot;</span><span class="p">)</span>

    <span class="c1"># todo - add that 2nd and 3rd can&#39;t be repeats</span>
    <span class="n">ignore_repeats</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLEASE_SELECT</span><span class="p">,</span>
                      <span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Not applicable as no additional leak cause suspected&quot;</span><span class="p">,</span>
                      <span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_repeats</span> <span class="ow">and</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">data</span><span class="p">]):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q17 appears to be a repeat&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_repeats</span> <span class="ow">and</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span><span class="p">]):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q18 appears to be a repeat&quot;</span><span class="p">)</span>

    <span class="c1"># not sure if this test makes sense since they may have know about it prior to the plume (going to comment out)</span>
    <span class="c1"># if self.observation_timestamp.data and self.inspection_timestamp.data:</span>
    <span class="c1">#   if self.inspection_timestamp.data &lt; self.observation_timestamp.data:</span>
    <span class="c1">#     self.inspection_timestamp.errors.append(</span>
    <span class="c1">#       &quot;Date of inspection cannot be prior to date of initial plume observation.&quot;)</span>

    <span class="c1">###################################################################################################</span>
    <span class="c1"># perform any form level validation and append it to the form_errors property</span>
    <span class="c1"># This may not be useful, but if you want to have form level errors appear at the top of the error</span>
    <span class="c1"># header, put the logic here.</span>
    <span class="c1">###################################################################################################</span>
    <span class="c1"># self.form_errors.append(&quot;I&#39;m a form level error #1&quot;)</span>
    <span class="c1"># self.form_errors.append(&quot;I&#39;m a form level error #2&quot;)</span>

    <span class="c1">###################################################################################################</span>
    <span class="c1"># Search and replace the error messages associated with input fields with a custom message</span>
    <span class="c1"># For instance, the default &#39;float&#39; error is changed because a typical user will not know what a</span>
    <span class="c1"># float value is (they will be more comfortable with the word &#39;numeric&#39;)</span>
    <span class="c1">###################################################################################################</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">form_fields</span><span class="p">:</span>
      <span class="n">field_errors</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">errors</span>
      <span class="n">replace_list_occurrences</span><span class="p">(</span><span class="n">field_errors</span><span class="p">,</span> <span class="n">error_message_replacement_dict</span><span class="p">)</span>

    <span class="c1">###################################################################################################</span>
    <span class="c1"># Current logic to determine if form is valid the error dict must be empty.</span>
    <span class="c1"># #Consider other approaches</span>
    <span class="c1">###################################################################################################</span>
    <span class="n">form_valid</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">form_valid</span>

  <span class="k">def</span><span class="w"> </span><span class="nf">determine_contingent_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add or remove field validators depending on contingent dropdown selections.</span>

<span class="sd">    Some dropdown options imply that no further input is needed (e.g.,</span>
<span class="sd">    selecting &quot;No leak was detected&quot; disables required validation on</span>
<span class="sd">    follow-up questions). This function clears or restores validators</span>
<span class="sd">    accordingly.</span>

<span class="sd">    These fields toggle between required and optional depending on related</span>
<span class="sd">    field values (e.g., dropdowns that are set to &quot;Other&quot;, or location-dependent fields).</span>
<span class="sd">    Some validation rules involve mutually exclusive or fallback logic.</span>

<span class="sd">    Notes:</span>
<span class="sd">      - This function should be called before validation to sync requirements.</span>
<span class="sd">      - May need to re-order exclusions (e.g., venting) for edge cases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If a venting exclusion is claimed, then a venting description is required and many fields become optional</span>
    <span class="n">required_if_emission_identified</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;additional_activities&quot;</span><span class="p">,</span>
      <span class="s2">&quot;initial_leak_concentration&quot;</span><span class="p">,</span>
      <span class="c1"># &quot;lat_revised&quot;,</span>
      <span class="c1"># &quot;long_revised&quot;,</span>
      <span class="s2">&quot;emission_type_fk&quot;</span><span class="p">,</span>
      <span class="s2">&quot;emission_location&quot;</span><span class="p">,</span>
      <span class="c1"># &quot;emission_location_notes&quot;,</span>
      <span class="s2">&quot;emission_cause&quot;</span><span class="p">,</span>
      <span class="c1"># &quot;emission_cause_secondary&quot;,</span>
      <span class="c1"># &quot;emission_cause_tertiary&quot;,</span>
      <span class="s2">&quot;emission_cause_notes&quot;</span><span class="p">,</span>
      <span class="s2">&quot;mitigation_actions&quot;</span><span class="p">,</span>
      <span class="s2">&quot;mitigation_timestamp&quot;</span><span class="p">,</span>
      <span class="s2">&quot;re_monitored_timestamp&quot;</span><span class="p">,</span>
      <span class="s2">&quot;re_monitored_concentration&quot;</span><span class="p">,</span>
      <span class="s2">&quot;included_in_last_lmr&quot;</span><span class="p">,</span>
      <span class="s2">&quot;included_in_last_lmr_description&quot;</span><span class="p">,</span>
      <span class="s2">&quot;planned_for_next_lmr&quot;</span><span class="p">,</span>
      <span class="s2">&quot;planned_for_next_lmr_description&quot;</span><span class="p">,</span>
      <span class="s2">&quot;last_surface_monitoring_timestamp&quot;</span><span class="p">,</span>
      <span class="s2">&quot;last_component_leak_monitoring_timestamp&quot;</span><span class="p">,</span>
      <span class="s2">&quot;additional_notes&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="c1"># todo - update logic for new selectors</span>
    <span class="n">emission_identified_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_identified_flag_fk</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="s2">&quot;No leak was detected&quot;</span>
    <span class="c1"># print(f&quot;{emission_identified_test=}&quot;)</span>
    <span class="n">change_validators_on_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emission_identified_test</span><span class="p">,</span> <span class="n">required_if_emission_identified</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">emission_identified_test</span><span class="p">:</span>
      <span class="n">lmr_included_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">included_in_last_lmr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;No&quot;</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lmr_included_test</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">change_validators_on_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lmr_included_test</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;included_in_last_lmr_description&quot;</span><span class="p">])</span>

      <span class="n">lmr_planned_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planned_for_next_lmr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;No&quot;</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lmr_planned_test</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">change_validators_on_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lmr_planned_test</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;planned_for_next_lmr_description&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="arb.portal.wtf_landfill.LandfillFeedback.determine_contingent_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">determine_contingent_fields</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add or remove field validators depending on contingent dropdown selections.</p>
<p>Some dropdown options imply that no further input is needed (e.g.,
selecting "No leak was detected" disables required validation on
follow-up questions). This function clears or restores validators
accordingly.</p>
<p>These fields toggle between required and optional depending on related
field values (e.g., dropdowns that are set to "Other", or location-dependent fields).
Some validation rules involve mutually exclusive or fallback logic.</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>This function should be called before validation to sync requirements.</li>
<li>May need to re-order exclusions (e.g., venting) for edge cases.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\portal\wtf_landfill.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">determine_contingent_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Add or remove field validators depending on contingent dropdown selections.</span>

<span class="sd">  Some dropdown options imply that no further input is needed (e.g.,</span>
<span class="sd">  selecting &quot;No leak was detected&quot; disables required validation on</span>
<span class="sd">  follow-up questions). This function clears or restores validators</span>
<span class="sd">  accordingly.</span>

<span class="sd">  These fields toggle between required and optional depending on related</span>
<span class="sd">  field values (e.g., dropdowns that are set to &quot;Other&quot;, or location-dependent fields).</span>
<span class="sd">  Some validation rules involve mutually exclusive or fallback logic.</span>

<span class="sd">  Notes:</span>
<span class="sd">    - This function should be called before validation to sync requirements.</span>
<span class="sd">    - May need to re-order exclusions (e.g., venting) for edge cases.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># If a venting exclusion is claimed, then a venting description is required and many fields become optional</span>
  <span class="n">required_if_emission_identified</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;additional_activities&quot;</span><span class="p">,</span>
    <span class="s2">&quot;initial_leak_concentration&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;lat_revised&quot;,</span>
    <span class="c1"># &quot;long_revised&quot;,</span>
    <span class="s2">&quot;emission_type_fk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;emission_location&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;emission_location_notes&quot;,</span>
    <span class="s2">&quot;emission_cause&quot;</span><span class="p">,</span>
    <span class="c1"># &quot;emission_cause_secondary&quot;,</span>
    <span class="c1"># &quot;emission_cause_tertiary&quot;,</span>
    <span class="s2">&quot;emission_cause_notes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mitigation_actions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mitigation_timestamp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;re_monitored_timestamp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;re_monitored_concentration&quot;</span><span class="p">,</span>
    <span class="s2">&quot;included_in_last_lmr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;included_in_last_lmr_description&quot;</span><span class="p">,</span>
    <span class="s2">&quot;planned_for_next_lmr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;planned_for_next_lmr_description&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last_surface_monitoring_timestamp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last_component_leak_monitoring_timestamp&quot;</span><span class="p">,</span>
    <span class="s2">&quot;additional_notes&quot;</span><span class="p">,</span>
  <span class="p">]</span>
  <span class="c1"># todo - update logic for new selectors</span>
  <span class="n">emission_identified_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_identified_flag_fk</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="s2">&quot;No leak was detected&quot;</span>
  <span class="c1"># print(f&quot;{emission_identified_test=}&quot;)</span>
  <span class="n">change_validators_on_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emission_identified_test</span><span class="p">,</span> <span class="n">required_if_emission_identified</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">emission_identified_test</span><span class="p">:</span>
    <span class="n">lmr_included_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">included_in_last_lmr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;No&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lmr_included_test</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">change_validators_on_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lmr_included_test</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;included_in_last_lmr_description&quot;</span><span class="p">])</span>

    <span class="n">lmr_planned_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planned_for_next_lmr</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;No&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lmr_planned_test</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">change_validators_on_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lmr_planned_test</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;planned_for_next_lmr_description&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="arb.portal.wtf_landfill.LandfillFeedback.update_contingent_selectors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_contingent_selectors</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update contingent dropdown field choices based on current field selections.</p>
<p>This method looks up selector/contingent relationships defined in
<code>Globals.drop_downs_contingent</code> and dynamically modifies the <code>choices</code>
for child fields when a selector field has a known dependency.</p>
<p>This method dynamically updates the primary, secondary, and tertiary
emission cause fields based on the value of <code>self.emission_location</code>. It
ensures valid dropdown options and clears invalid selections.</p>


<details class="assumes" open>
  <summary>Assumes</summary>
  <ul>
<li><code>self.emission_location</code>, <code>self.emission_cause</code>,
  <code>self.emission_cause_secondary</code>, and <code>self.emission_cause_tertiary</code>
  are all <code>SelectField</code> instances.</li>
<li><code>Globals.drop_downs_contingent</code> contains a nested dictionary of
  location-contingent dropdown options.</li>
</ul>
</details>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>None</code>
              â€“
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>arb\portal\wtf_landfill.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_contingent_selectors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Update contingent dropdown field choices based on current field selections.</span>

<span class="sd">  This method looks up selector/contingent relationships defined in</span>
<span class="sd">  `Globals.drop_downs_contingent` and dynamically modifies the `choices`</span>
<span class="sd">  for child fields when a selector field has a known dependency.</span>

<span class="sd">  This method dynamically updates the primary, secondary, and tertiary</span>
<span class="sd">  emission cause fields based on the value of `self.emission_location`. It</span>
<span class="sd">  ensures valid dropdown options and clears invalid selections.</span>

<span class="sd">  Assumes:</span>
<span class="sd">    - `self.emission_location`, `self.emission_cause`,</span>
<span class="sd">      `self.emission_cause_secondary`, and `self.emission_cause_tertiary`</span>
<span class="sd">      are all `SelectField` instances.</span>
<span class="sd">    - `Globals.drop_downs_contingent` contains a nested dictionary of</span>
<span class="sd">      location-contingent dropdown options.</span>

<span class="sd">  Returns:</span>
<span class="sd">    None</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c1"># todo - update contingent dropdowns?</span>

  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running update_contingent_selectors()&quot;</span><span class="p">)</span>

  <span class="n">emission_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">data</span>
  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selected emission_location: </span><span class="si">{</span><span class="n">emission_location</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="n">emission_cause_dict</span> <span class="o">=</span> <span class="n">Globals</span><span class="o">.</span><span class="n">drop_downs_contingent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s2">&quot;emission_cause_contingent_on_emission_location&quot;</span><span class="p">,</span> <span class="p">{}</span>
  <span class="p">)</span>
  <span class="n">choices_raw</span> <span class="o">=</span> <span class="n">emission_cause_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">emission_location</span><span class="p">,</span> <span class="p">[])</span>
  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available contingent causes: </span><span class="si">{</span><span class="n">choices_raw</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="c1"># Define headers</span>
  <span class="n">primary_header</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">PLEASE_SELECT</span><span class="p">,</span> <span class="n">PLEASE_SELECT</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;disabled&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
    <span class="p">(</span><span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span> <span class="p">{}),</span>
  <span class="p">]</span>
  <span class="n">secondary_tertiary_header</span> <span class="o">=</span> <span class="n">primary_header</span> <span class="o">+</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Not applicable as no additional leak cause suspected&quot;</span><span class="p">,</span>
     <span class="s2">&quot;Not applicable as no additional leak cause suspected&quot;</span><span class="p">,</span> <span class="p">{}),</span>
  <span class="p">]</span>

  <span class="c1"># Build full choices</span>
  <span class="n">primary_choices</span> <span class="o">=</span> <span class="n">build_choices</span><span class="p">(</span><span class="n">primary_header</span><span class="p">,</span> <span class="n">choices_raw</span><span class="p">)</span>
  <span class="n">secondary_tertiary_choices</span> <span class="o">=</span> <span class="n">build_choices</span><span class="p">(</span><span class="n">secondary_tertiary_header</span><span class="p">,</span> <span class="n">choices_raw</span><span class="p">)</span>

  <span class="c1"># Update each field&#39;s choices</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">primary_choices</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">secondary_tertiary_choices</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">secondary_tertiary_choices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="arb.portal.wtf_landfill.LandfillFeedback.validate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate</span><span class="p">(</span><span class="n">extra_validators</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Override WTForms default validation with custom cross-field logic.</p>
<p>Ensures required fields are conditionally enforced based on upstream
values, including:
  - Facility activity selections imply required contingent selections
  - If "Other" is chosen, corresponding text input must be filled
  - If leak is confirmed, additional emission details are required</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="bool">bool</span></code>
)              â€“
              <div class="doc-md-description">
                <p>True if form is valid, False otherwise.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Calls <code>determine_contingent_fields()</code> before validation to
  ensure field validators are correct.</li>
<li>Uses built-in <code>super().validate()</code> after adjusting validators.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>arb\portal\wtf_landfill.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_validators</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Override WTForms default validation with custom cross-field logic.</span>

<span class="sd">  Ensures required fields are conditionally enforced based on upstream</span>
<span class="sd">  values, including:</span>
<span class="sd">    - Facility activity selections imply required contingent selections</span>
<span class="sd">    - If &quot;Other&quot; is chosen, corresponding text input must be filled</span>
<span class="sd">    - If leak is confirmed, additional emission details are required</span>

<span class="sd">  Returns:</span>
<span class="sd">    bool: True if form is valid, False otherwise.</span>

<span class="sd">  Notes:</span>
<span class="sd">    - Calls `determine_contingent_fields()` before validation to</span>
<span class="sd">      ensure field validators are correct.</span>
<span class="sd">    - Uses built-in `super().validate()` after adjusting validators.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;validate() called.&quot;</span><span class="p">)</span>
  <span class="n">form_fields</span> <span class="o">=</span> <span class="n">get_wtforms_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

  <span class="c1"># Dictionary to replace standard WTForm messages with an alternative message</span>
  <span class="n">error_message_replacement_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Not a valid float value.&quot;</span><span class="p">:</span> <span class="s2">&quot;Not a valid numeric value.&quot;</span><span class="p">}</span>

  <span class="c1">###################################################################################################</span>
  <span class="c1"># Add, Remove, or Modify validation at a field level here before the super is called (for example)</span>
  <span class="c1">###################################################################################################</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">determine_contingent_fields</span><span class="p">()</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">update_contingent_selectors</span><span class="p">()</span>

  <span class="c1">###################################################################################################</span>
  <span class="c1"># Set selectors with values not in their choice&#39;s list to &quot;Please Select&quot;</span>
  <span class="c1">###################################################################################################</span>
  <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">form_fields</span><span class="p">:</span>
    <span class="n">field</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;field_name: </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">raw_data</span><span class="p">)</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">SelectField</span><span class="p">):</span>
      <span class="n">ensure_field_choice</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>

  <span class="c1">###################################################################################################</span>
  <span class="c1"># call the super to perform each field&#39;s individual validation (which saves to form.errors)</span>
  <span class="c1"># This will create the form.errors dictionary.  If there are form_errors they will be in the None key.</span>
  <span class="c1"># The form_errors will not affect if validate returns True/False, only the fields are considered.</span>
  <span class="c1">###################################################################################################</span>
  <span class="c1"># logger.debug(f&quot;in the validator before super&quot;)</span>
  <span class="n">obj_diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;in the validator before super&quot;</span><span class="p">)</span>

  <span class="n">_</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">extra_validators</span><span class="o">=</span><span class="n">extra_validators</span><span class="p">)</span>

  <span class="c1">###################################################################################################</span>
  <span class="c1"># Validating selectors explicitly ensures the same number of errors on GETS and POSTS for the same data</span>
  <span class="c1">###################################################################################################</span>
  <span class="n">validate_selectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PLEASE_SELECT</span><span class="p">)</span>

  <span class="c1">###################################################################################################</span>
  <span class="c1"># Perform any field level validation where one field is cross-referenced to another</span>
  <span class="c1"># The error will be associated with one of the fields</span>
  <span class="c1">###################################################################################################</span>
  <span class="c1"># todo - move field level validation to separate function</span>

  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_identified_flag_fk</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;No leak was detected&quot;</span><span class="p">:</span>
    <span class="n">valid_options</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLEASE_SELECT</span><span class="p">,</span>
                     <span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;Not applicable as no additional leak cause suspected&quot;</span><span class="p">,</span>
                     <span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q13 appear to be inconsistent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q14 appear to be inconsistent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q16 appear to be inconsistent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q17 appear to be inconsistent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q18 appear to be inconsistent&quot;</span><span class="p">)</span>

  <span class="c1"># Q8 and Q13 should be coupled to Operator-aware response</span>
  <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_identified_flag_fk</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s2">&quot;Operator was aware of the leak prior to receiving the CARB plume notification&quot;</span><span class="p">:</span>
    <span class="n">valid_options</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLEASE_SELECT</span><span class="p">,</span>
                     <span class="s2">&quot;Operator was aware of the leak prior to receiving the notification, and/or repairs were in progress on the date of the plume observation&quot;</span><span class="p">,</span> <span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q13 appear to be inconsistent&quot;</span><span class="p">)</span>

  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_identified_flag_fk</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="s2">&quot;No leak was detected&quot;</span><span class="p">:</span>
    <span class="n">invalid_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span> <span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_type_fk</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q13 appear to be inconsistent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_location</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q14 appear to be inconsistent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q16 appear to be inconsistent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q17 appear to be inconsistent&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="n">invalid_options</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q8 and Q18 appear to be inconsistent&quot;</span><span class="p">)</span>

  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspection_timestamp</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mitigation_timestamp</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mitigation_timestamp</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">inspection_timestamp</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">mitigation_timestamp</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="s2">&quot;Date of mitigation cannot be prior to initial site inspection.&quot;</span><span class="p">)</span>

  <span class="c1"># todo - add that 2nd and 3rd can&#39;t be repeats</span>
  <span class="n">ignore_repeats</span> <span class="o">=</span> <span class="p">[</span><span class="n">PLEASE_SELECT</span><span class="p">,</span>
                    <span class="s2">&quot;Not applicable as no leak was detected&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Not applicable as no additional leak cause suspected&quot;</span><span class="p">,</span>
                    <span class="p">]</span>

  <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_repeats</span> <span class="ow">and</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">data</span><span class="p">]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q17 appears to be a repeat&quot;</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_repeats</span> <span class="ow">and</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_tertiary</span><span class="o">.</span><span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">emission_cause</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">data</span><span class="p">]):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">emission_cause_secondary</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q18 appears to be a repeat&quot;</span><span class="p">)</span>

  <span class="c1"># not sure if this test makes sense since they may have know about it prior to the plume (going to comment out)</span>
  <span class="c1"># if self.observation_timestamp.data and self.inspection_timestamp.data:</span>
  <span class="c1">#   if self.inspection_timestamp.data &lt; self.observation_timestamp.data:</span>
  <span class="c1">#     self.inspection_timestamp.errors.append(</span>
  <span class="c1">#       &quot;Date of inspection cannot be prior to date of initial plume observation.&quot;)</span>

  <span class="c1">###################################################################################################</span>
  <span class="c1"># perform any form level validation and append it to the form_errors property</span>
  <span class="c1"># This may not be useful, but if you want to have form level errors appear at the top of the error</span>
  <span class="c1"># header, put the logic here.</span>
  <span class="c1">###################################################################################################</span>
  <span class="c1"># self.form_errors.append(&quot;I&#39;m a form level error #1&quot;)</span>
  <span class="c1"># self.form_errors.append(&quot;I&#39;m a form level error #2&quot;)</span>

  <span class="c1">###################################################################################################</span>
  <span class="c1"># Search and replace the error messages associated with input fields with a custom message</span>
  <span class="c1"># For instance, the default &#39;float&#39; error is changed because a typical user will not know what a</span>
  <span class="c1"># float value is (they will be more comfortable with the word &#39;numeric&#39;)</span>
  <span class="c1">###################################################################################################</span>
  <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">form_fields</span><span class="p">:</span>
    <span class="n">field_errors</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">errors</span>
    <span class="n">replace_list_occurrences</span><span class="p">(</span><span class="n">field_errors</span><span class="p">,</span> <span class="n">error_message_replacement_dict</span><span class="p">)</span>

  <span class="c1">###################################################################################################</span>
  <span class="c1"># Current logic to determine if form is valid the error dict must be empty.</span>
  <span class="c1"># #Consider other approaches</span>
  <span class="c1">###################################################################################################</span>
  <span class="n">form_valid</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">form_valid</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../sqla_models/" class="btn btn-neutral float-left" title="arb.portal.sqla_models"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../wtf_oil_and_gas/" class="btn btn-neutral float-right" title="arb.portal.wtf_oil_and_gas">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../sqla_models/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../wtf_oil_and_gas/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../../..";</script>
    <script src="../../../../js/theme_extra.js"></script>
    <script src="../../../../js/theme.js"></script>
      <script src="../../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
