

{% block flash_messages %}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container mt-3">
        {% for category, message in messages %}
          {% if category == "internal-marker" %}
            {# ðŸªª Internal test marker: invisible to users, visible to Playwright #}
            {% if message == "_upload_attempted" %}
              <div class="upload-marker" data-upload-attempted="true" style="display: none;"></div>
              <script>
                // Robust backup: Set session storage when marker is rendered
                (function() {
                  try {
                    sessionStorage.setItem('_upload_attempt_state', 'attempted');
                    sessionStorage.setItem('_upload_attempt_timestamp', Date.now().toString());
                    console.log('[TEST] Upload attempt state set in session storage');
                  } catch (e) {
                    console.warn('[TEST] Failed to set session storage:', e);
                  }
                })();
              </script>
            {% endif %}
          {% else %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}
{% endblock %}